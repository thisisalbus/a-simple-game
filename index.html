<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Battlefield ‚Äî War Vocabulary Game</title>
  <style>
    :root{
      --bg:#1a1f1a;
      --card:#374c37;
      --sidebar:#605123;
      --sidebar-btn:#2f727d;
      --sidebar-btn-hover:#39b9be;
      --accent:#8ac249;
      --accent2:#c19a6b;
      --muted:#a39b8d;
      --danger:#c0392b;
      --warning:#f39c12;
      --success:#27ae60;
      --combo:#9b59b6;
      --question-bg:#3055a5;
      --option-bg:#4293be;
    }
    *{box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0d0d0d 0%, #1a1a1a 60%);color:#e6eef8;overflow-x:hidden}
    .container{max-width:1100px;margin:26px auto;padding:22px}
    header{display:flex;align-items:center;gap:18px}
    .logo{width:68px;height:68px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#04263b;font-size:26px;box-shadow:0 8px 30px rgba(6,12,24,.6)}
    h1{margin:0;font-size:22px}
    p.lead{margin-top:6px;color:var(--muted)}
    .main{display:grid;grid-template-columns:340px 1fr;gap:18px;margin-top:18px}

    /* left panel */
    .panel{background:var(--sidebar);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    .menu button{display:block;width:100%;padding:12px;border-radius:10px;border:0;background:var(--sidebar-btn);color:inherit;text-align:left;margin-bottom:8px;font-weight:600;cursor:pointer;transition:all 0.2s}
    .menu button:hover{background:var(--sidebar-btn-hover);transform:translateX(5px)}
    .menu button.active{background:var(--accent);color:#000;box-shadow:0 4px 8px rgba(138,194,73,0.3)}
    .score{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
    .score .big{font-size:28px;font-weight:800}
    .small{color:var(--muted);font-size:13px}

    /* right content */
    .content{min-height:420px;padding:18px;border-radius:12px}
    .card{background:var(--question-bg);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)}
    .controls{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    .btn{background:linear-gradient(90deg,var(--accent2),var(--accent));padding:10px 14px;border-radius:10px;border:0;color:#04263b;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:0.6;cursor:not-allowed}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.2);padding:10px 12px;border-radius:10px;color:var(--muted);transition:all 0.2s}
    .ghost:hover{background:rgba(255,255,255,0.05);color:#fff}

    /* quiz */
    .question{font-size:20px;font-weight:700;margin:12px 0}
    .options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .option{padding:12px;border-radius:10px;background:var(--option-bg);cursor:pointer;border:1px solid rgba(255,255,255,0.1);transition:all 0.2s}
    .option:hover{transform:translateY(-3px);background:rgba(255,255,255,0.05)}
    .option.correct{outline:3px solid rgba(138,194,73,0.14);background:linear-gradient(90deg, rgba(138,194,73,0.04), rgba(193,154,107,0.02));}
    .option.wrong{outline:3px solid rgba(192,57,43,0.12);opacity:.9}

    /* Visual feedback */
    .feedback-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 24px;
      font-weight: bold;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      text-align: center;
    }
    .feedback-correct {
      background-color: var(--success);
      color: white;
    }
    .feedback-wrong {
      background-color: var(--danger);
      color: white;
    }
    .feedback-combo {
      background-color: var(--combo);
      color: white;
    }

    /* level progress */
    .level-progress{margin-top:15px}
    .progress-bar{height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden;margin-top:5px}
    .progress-fill{height:100%;background:var(--accent);border-radius:5px;transition:width 0.3s ease}
    
    /* health & strength bars */
    .stat-bars{display:flex;gap:15px;margin-top:15px}
    .stat-bar{flex:1}
    .stat-label{display:flex;justify-content:space-between;margin-bottom:5px;font-size:14px}
    .bar-container{height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden}
    .health-fill{height:100%;background:var(--danger);border-radius:5px;transition:width 0.3s ease}
    .strength-fill{height:100%;background:var(--warning);border-radius:5px;transition:width 0.3s ease}
    
    /* level indicator */
    .level-indicator{display:flex;align-items:center;gap:10px;margin-bottom:15px}
    .level-badge{padding:5px 10px;background:var(--accent);color:#000;border-radius:20px;font-weight:bold;font-size:14px}
    
    /* badges */
    .badges{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}
    .badge{padding:5px 10px;background:var(--accent2);color:#000;border-radius:20px;font-size:12px;font-weight:bold}
    
    /* combo counter */
    .combo-counter {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      font-weight: bold;
      color: var(--combo);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .combo-counter.active {
      opacity: 1;
    }
    
    /* difficulty selector */
    .difficulty-selector {
      margin-top: 15px;
    }
    .difficulty-btn {
      padding: 5px 10px;
      margin-right: 5px;
      border-radius: 5px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: inherit;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    .difficulty-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    .difficulty-btn.active {
      background: var(--accent);
      color: #000;
    }
    
    /* game over modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
    .modal-content{background:var(--card);padding:25px;border-radius:12px;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center}
    .modal-header{font-size:24px;font-weight:700;margin-bottom:15px;color:var(--accent)}
    .modal-body{margin-bottom:20px}
    .modal-buttons{display:flex;gap:10px;justify-content:center}

    /* Army visualization */
    .army-container {
      height: 40px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 5px;
      position: relative;
      overflow: hidden;
    }
    .army-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(138,194,73,0.1), transparent);
      animation: shimmer 2s infinite;
    }
    .soldier {
      position: relative;
      font-size: 24px;
      margin: 0 2px;
      z-index: 1;
    }
    
    /* Action buttons in sidebar */
    .action-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
    }
    .action-buttons .ghost {
      flex: 1;
      padding: 8px;
      font-size: 12px;
      text-align: center;
    }
    
    /* Loading indicator */
    .loading-indicator {
      display: none;
      text-align: center;
      padding: 10px;
      color: var(--muted);
    }
    .loading-indicator.active {
      display: block;
    }

    /* responsive */
    @media(max-width:900px){.main{grid-template-columns:1fr;}.logo{width:58px;height:58px}}
    
    /* Animations */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .shake {
      animation: shake 0.5s;
    }
    .pulse {
      animation: pulse 0.5s;
    }
    .fade-in {
      animation: fadeIn 0.5s;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">‚öîÔ∏è</div>
      <div style="flex:1">
        <h1 id="title">Word Battlefield ‚Äî War Vocabulary Game</h1>
        <p class="lead" id="lead">Build your vocabulary army to defeat the enemy! Learn war-related terms through strategic battles.</p>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <div style="display:flex;gap:6px">
          <button id="langEn" class="ghost">EN</button>
          <button id="langVi" class="ghost">VI</button>
        </div>
        <a id="downloadBtn" class="btn" href="#" download="word-battlefield.html">Download HTML</a>
      </div>
    </header>

    <div class="main">
      <aside class="panel">
        <div class="action-buttons">
          <button id="btn-reset" class="ghost">Reset Game</button>
          <button id="btn-help" class="ghost">How to Play</button>
        </div>
        
        <div class="menu">
          <button id="btn-battle" class="active">‚öîÔ∏è Battle</button>
          <button id="btn-barracks">üè∞ Barracks</button>
          <button id="btn-edit">‚úèÔ∏è Edit Words</button>
        </div>

        <div class="score">
          <div class="big" id="score">Army: 0</div>
          <div class="small">Level: <span id="level">1</span> ‚Ä¢ Health: <span id="health">100</span></div>
        </div>

        <div class="stat-bars">
          <div class="stat-bar">
            <div class="stat-label">
              <span>Health</span>
              <span id="healthPercent">100%</span>
            </div>
            <div class="bar-container">
              <div id="healthBar" class="health-fill" style="width:100%"></div>
            </div>
          </div>
          <div class="stat-bar">
            <div class="stat-label">
              <span>Army Strength</span>
              <span id="strengthValue">0</span>
            </div>
            <div class="bar-container">
              <div id="strengthBar" class="strength-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <div class="level-progress">
          <div class="level-indicator">
            <span>Current Mission:</span>
            <div id="currentLevel" class="level-badge">Level 1: Boot Camp</div>
          </div>
          <div class="progress-bar">
            <div id="levelProgress" class="progress-fill" style="width:0%"></div>
          </div>
          <div class="small" style="margin-top:5px">Progress: <span id="progressText">0/5</span></div>
        </div>

        <div class="badges" id="badgesContainer">
          <div class="badge" style="background:#555">No Badges Yet</div>
        </div>

        <div class="difficulty-selector">
          <div class="small">Vocabulary Set:</div>
          <button class="difficulty-btn active" data-diff="easy">Basic Terms</button>
          <button class="difficulty-btn" data-diff="medium">Advanced Terms</button>
          <button class="difficulty-btn" data-diff="hard">Expert Terms</button>
        </div>
      </aside>

      <section class="content">
        <div id="view-battle" class="card">
          <div class="army-container" id="armyContainer"></div>
          
          <div class="controls">
            <button id="nextBattle" class="btn">Start Battle</button>
            <div style="margin-left:auto" class="small">Timer: <span id="timer">--</span></div>
          </div>
          
          <div class="combo-counter" id="comboCounter">Combo: x<span id="comboValue">0</span></div>
          <div id="battleArea">
            <div class="question" id="questionText">Press "Start Battle" to begin your first mission!</div>
            <div class="options" id="options"></div>
          </div>
        </div>

        <div id="view-barracks" class="card" style="margin-top:12px;display:none">
          <div class="small">Your barracks. Here you can review the vocabulary you've learned and prepare for battle.</div>
          <div style="margin-top:15px">
            <h3 style="margin-top:0">Your Vocabulary Army</h3>
            <div id="barracksContent" style="margin-top:10px">
              <p style="color:var(--muted)">Complete battles to unlock words in your barracks.</p>
            </div>
          </div>
        </div>

        <div id="view-edit" class="card" style="margin-top:12px;display:none">
          <div class="small">Edit the vocabulary list (JSON). Structure: {"easy": {...}, "medium": {...}, "hard": {...}}</div>
          <textarea id="vocabJson" style="width:100%;height:260px;margin-top:8px;border-radius:8px;padding:10px;background:#031524;color:#ccdef7;border:1px solid rgba(255,255,255,0.03);"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="saveVocab" class="btn">Save</button>
            <button id="resetVocab" class="ghost">Reset to Default</button>
          </div>
        </div>

      </section>
    </div>

    <footer id="footer">Build your vocabulary army to conquer the battlefield! Complete all missions to become a Word Commander.</footer>
  </div>

  <!-- Feedback Message -->
  <div id="feedbackMessage" class="feedback-message"></div>

  <!-- Game Over Modal -->
  <div id="gameOverModal" class="modal">
    <div class="modal-content">
      <div class="modal-header" id="gameOverTitle">Game Over</div>
      <div class="modal-body" id="gameOverMessage">
        Your army has been defeated. Try again to build a stronger vocabulary force!
      </div>
      <div class="modal-buttons">
        <button id="restartBtn" class="btn">Restart Game</button>
      </div>
    </div>
  </div>

  <!-- Level Complete Modal -->
  <div id="levelCompleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header" id="levelCompleteTitle">Mission Complete!</div>
      <div class="modal-body" id="levelCompleteMessage">
        You've successfully completed this mission. Your army grows stronger!
      </div>
      <div class="modal-buttons">
        <button id="nextLevelBtn" class="btn">Next Mission</button>
      </div>
    </div>
  </div>

<script>
/* ===== language & strings ===== */
let LANG='en';
const STRINGS = {
  en: {
    battle:'‚öîÔ∏è Battle', barracks:'üè∞ Barracks', edit:'‚úèÔ∏è Edit Words',
    tip:'Build your vocabulary army to conquer the battlefield! Complete all missions to become a Word Commander.',
    how: `Word Battlefield - War Vocabulary Game

How to Play:
1. Start at Level 1 (Boot Camp) and progress through missions.
2. Each battle presents a war-related vocabulary word.
3. Choose the correct definition from 4 options.
4. Correct answers strengthen your army (+10 strength).
5. Wrong answers reduce your health (-5 health) and army strength (-3).
6. Complete each level by answering the required number of questions correctly.
7. Earn badges for completing missions: The Strategist, The Commander, The Conqueror.
8. Build combos for consecutive correct answers to earn bonus points.
9. Defeat the Final Boss to win the game!

Game Over: If your health reaches 0, your army is defeated.

Good luck, Commander!`,
    scoring: `Scoring System:
‚Ä¢ Correct answer: +10 Army Strength
‚Ä¢ Wrong answer: -5 Health, -3 Army Strength
‚Ä¢ Combo x2: +5 Bonus Strength
‚Ä¢ Combo x3: +10 Bonus Strength
‚Ä¢ Combo x5+: +15 Bonus Strength
‚Ä¢ Level 1: Complete 5 correct answers
‚Ä¢ Level 2: Complete 7 correct answers
‚Ä¢ Level 3: Complete 10 correct answers
‚Ä¢ Final Boss: Get 10 out of 12 questions correct
‚Ä¢ Badges: Earned for completing each level`,
    level1: "Level 1: Boot Camp",
    level2: "Level 2: Battlefield",
    level3: "Level 3: Campaign",
    finalBoss: "Final Boss: Ultimate Battle",
    gameOver: "Game Over",
    gameOverMsg: "Your army has been defeated. Try again to build a stronger vocabulary force!",
    levelComplete: "Mission Complete!",
    levelCompleteMsg: "You've successfully completed this mission. Your army grows stronger!",
    restart: "Restart Game",
    nextLevel: "Next Mission",
    noBadges: "No Badges Yet",
    barracksEmpty: "Complete battles to unlock words in your barracks.",
    startBattle: "Start Battle",
    continueBattle: "Continue",
    pressStart: "Press \"Start Battle\" to begin your first mission!",
    correct: "Correct!",
    wrong: "Wrong!",
    combo2: "Combo x2!",
    combo3: "Combo x3!",
    combo5: "Amazing Combo!",
    basic: "Basic Terms",
    advanced: "Advanced Terms",
    expert: "Expert Terms",
    vocabSet: "Vocabulary Set:",
    loading: "Loading vocabulary...",
    vocabError: "Error loading vocabulary. Using default set.",
    noVocab: "No vocabulary available for this level."
  },
  vi: {
    battle:'‚öîÔ∏è Tr·∫≠n chi·∫øn', barracks:'üè∞ Doanh tr·∫°i', edit:'‚úèÔ∏è Ch·ªânh s·ª≠a t·ª´',
    tip:'X√¢y d·ª±ng ƒë·ªôi qu√¢n t·ª´ v·ª±ng ƒë·ªÉ chinh ph·ª•c chi·∫øn tr∆∞·ªùng! Ho√†n th√†nh t·∫•t c·∫£ nhi·ªám v·ª• ƒë·ªÉ tr·ªü th√†nh Ch·ªâ huy t·ª´ v·ª±ng.',
    how: `Chi·∫øn tr∆∞·ªùng T·ª´ v·ª±ng - Tr√≤ ch∆°i T·ª´ v·ª±ng Ch·ªß ƒë·ªÅ Chi·∫øn tranh

C√°ch ch∆°i:
1. B·∫Øt ƒë·∫ßu ·ªü C·∫•p ƒë·ªô 1 (Tr·∫°i l√≠nh) v√† ti·∫øn h√†nh c√°c nhi·ªám v·ª•.
2. M·ªói tr·∫≠n chi·∫øn ƒë∆∞a ra m·ªôt t·ª´ v·ª±ng li√™n quan ƒë·∫øn chi·∫øn tranh.
3. Ch·ªçn ƒë·ªãnh nghƒ©a ƒë√∫ng t·ª´ 4 l·ª±a ch·ªçn.
4. Tr·∫£ l·ªùi ƒë√∫ng l√†m ƒë·ªôi qu√¢n c·ªßa b·∫°n m·∫°nh h∆°n (+10 s·ª©c m·∫°nh).
5. Tr·∫£ l·ªùi sai l√†m gi·∫£m m√°u c·ªßa b·∫°n (-5 m√°u) v√† s·ª©c m·∫°nh ƒë·ªôi qu√¢n (-3).
6. Ho√†n th√†nh m·ªói c·∫•p ƒë·ªô b·∫±ng c√°ch tr·∫£ l·ªùi ƒë√∫ng s·ªë c√¢u h·ªèi c·∫ßn thi·∫øt.
7. Nh·∫≠n huy hi·ªáu khi ho√†n th√†nh nhi·ªám v·ª•: Nh√† chi·∫øn l∆∞·ª£c, Ch·ªâ huy, Ng∆∞·ªùi chinh ph·ª•c.
8. X√¢y d·ª±ng combo cho c√°c c√¢u tr·∫£ l·ªùi ƒë√∫ng li√™n ti·∫øp ƒë·ªÉ nh·∫≠n ƒëi·ªÉm th∆∞·ªüng.
9. ƒê√°nh b·∫°i Tr√πm cu·ªëi ƒë·ªÉ th·∫Øng tr√≤ ch∆°i!

Tr√≤ ch∆°i k·∫øt th√∫c: N·∫øu m√°u c·ªßa b·∫°n v·ªÅ 0, ƒë·ªôi qu√¢n c·ªßa b·∫°n b·ªã ƒë√°nh b·∫°i.

Ch√∫c may m·∫Øn, Ch·ªâ huy!`,
    scoring: `H·ªá th·ªëng t√≠nh ƒëi·ªÉm:
‚Ä¢ Tr·∫£ l·ªùi ƒë√∫ng: +10 S·ª©c m·∫°nh ƒë·ªôi qu√¢n
‚Ä¢ Tr·∫£ l·ªùi sai: -5 M√°u, -3 S·ª©c m·∫°nh ƒë·ªôi qu√¢n
‚Ä¢ Combo x2: +5 ƒêi·ªÉm th∆∞·ªüng s·ª©c m·∫°nh
‚Ä¢ Combo x3: +10 ƒêi·ªÉm th∆∞·ªüng s·ª©c m·∫°nh
‚Ä¢ Combo x5+: +15 ƒêi·ªÉm th∆∞·ªüng s·ª©c m·∫°nh
‚Ä¢ C·∫•p ƒë·ªô 1: Ho√†n th√†nh 5 c√¢u tr·∫£ l·ªùi ƒë√∫ng
‚Ä¢ C·∫•p ƒë·ªô 2: Ho√†n th√†nh 7 c√¢u tr·∫£ l·ªùi ƒë√∫ng
‚Ä¢ C·∫•p ƒë·ªô 3: Ho√†n th√†nh 10 c√¢u tr·∫£ l·ªùi ƒë√∫ng
‚Ä¢ Tr√πm cu·ªëi: Tr·∫£ l·ªùi ƒë√∫ng 10/12 c√¢u h·ªèi
‚Ä¢ Huy hi·ªáu: Nh·∫≠n ƒë∆∞·ª£c khi ho√†n th√†nh m·ªói c·∫•p ƒë·ªô`,
    level1: "C·∫•p ƒë·ªô 1: Tr·∫°i l√≠nh",
    level2: "C·∫•p ƒë·ªô 2: Chi·∫øn tr∆∞·ªùng",
    level3: "C·∫•p ƒë·ªô 3: Chi·∫øn d·ªãch",
    finalBoss: "Tr√πm cu·ªëi: Tr·∫≠n chi·∫øn cu·ªëi c√πng",
    gameOver: "Tr√≤ ch∆°i k·∫øt th√∫c",
    gameOverMsg: "ƒê·ªôi qu√¢n c·ªßa b·∫°n ƒë√£ b·ªã ƒë√°nh b·∫°i. H√£y th·ª≠ l·∫°i ƒë·ªÉ x√¢y d·ª±ng ƒë·ªôi qu√¢n t·ª´ v·ª±ng m·∫°nh h∆°n!",
    levelComplete: "Nhi·ªám v·ª• ho√†n th√†nh!",
    levelCompleteMsg: "B·∫°n ƒë√£ ho√†n th√†nh th√†nh c√¥ng nhi·ªám v·ª• n√†y. ƒê·ªôi qu√¢n c·ªßa b·∫°n ng√†y c√†ng m·∫°nh h∆°n!",
    restart: "Ch∆°i l·∫°i",
    nextLevel: "Nhi·ªám v·ª• ti·∫øp theo",
    noBadges: "Ch∆∞a c√≥ huy hi·ªáu",
    barracksEmpty: "Ho√†n th√†nh c√°c tr·∫≠n chi·∫øn ƒë·ªÉ m·ªü kh√≥a t·ª´ v·ª±ng trong doanh tr·∫°i.",
    startBattle: "B·∫Øt ƒë·∫ßu tr·∫≠n chi·∫øn",
    continueBattle: "Ti·∫øp t·ª•c",
    pressStart: "Nh·∫•n \"B·∫Øt ƒë·∫ßu tr·∫≠n chi·∫øn\" ƒë·ªÉ b·∫Øt ƒë·∫ßu nhi·ªám v·ª• ƒë·∫ßu ti√™n c·ªßa b·∫°n!",
    correct: "ƒê√∫ng!",
    wrong: "Sai!",
    combo2: "Combo x2!",
    combo3: "Combo x3!",
    combo5: "Combo tuy·ªát v·ªùi!",
    basic: "Thu·∫≠t ng·ªØ C∆° b·∫£n",
    advanced: "Thu·∫≠t ng·ªØ N√¢ng cao",
    expert: "Thu·∫≠t ng·ªØ Chuy√™n gia",
    vocabSet: "B·ªô t·ª´ v·ª±ng:",
    loading: "ƒêang t·∫£i t·ª´ v·ª±ng...",
    vocabError: "L·ªói t·∫£i t·ª´ v·ª±ng. S·ª≠ d·ª•ng b·ªô t·ª´ m·∫∑c ƒë·ªãnh.",
    noVocab: "Kh√¥ng c√≥ t·ª´ v·ª±ng cho c·∫•p ƒë·ªô n√†y."
  }
};
function t(k){return STRINGS[LANG][k]||k}

/* ===== vocabulary loading ===== */
let vocab = null;
let vocabLoaded = false;
let vocabLoadingPromise = null;

async function loadVocabulary() {
  // If already loaded, return immediately
  if (vocabLoaded) {
    return;
  }
  
  // If loading is in progress, return the existing promise
  if (vocabLoadingPromise) {
    return vocabLoadingPromise;
  }
  
  // Start loading
  vocabLoadingPromise = (async () => {
    try {
      // Show loading indicator
      const loadingIndicator = document.getElementById('loadingIndicator');
      if (loadingIndicator) {
        loadingIndicator.classList.add('active');
      }
      
      // Try to load from localStorage first
      const localVocab = localStorage.getItem('wb_vocab');
      if (localVocab) {
        try {
          vocab = JSON.parse(localVocab);
          vocabLoaded = true;
          if (loadingIndicator) {
            loadingIndicator.classList.remove('active');
          }
          return;
        } catch (e) {
          console.error('Error parsing local vocabulary:', e);
        }
      }
      
      // If not in localStorage or parsing failed, fetch from the JSON file
      const response = await fetch('vocabulary.json');
      if (!response.ok) {
        throw new Error('Failed to load vocabulary file');
      }
      vocab = await response.json();
      
      // Save to localStorage for future use
      localStorage.setItem('wb_vocab', JSON.stringify(vocab));
      vocabLoaded = true;
      
      if (loadingIndicator) {
        loadingIndicator.classList.remove('active');
      }
    } catch (error) {
      console.error('Error loading vocabulary:', error);
      
      // Fallback to a minimal vocabulary set
      vocab = {
        easy: {
          level1: [
            {word:"War",def:"A state of armed conflict.",example:"The war lasted for years.",viDef:"Tr·∫°ng th√°i xung ƒë·ªôt v≈© trang.",viExample:"Cu·ªôc chi·∫øn k√©o d√†i nhi·ªÅu nƒÉm.",cat:"war"},
            {word:"Soldier",def:"A person serving in an army.",example:"The soldier was awarded a medal.",viDef:"Ng∆∞·ªùi ph·ª•c v·ª• trong qu√¢n ƒë·ªôi.",viExample:"Ng∆∞·ªùi l√≠nh ƒë√£ ƒë∆∞·ª£c trao huy ch∆∞∆°ng.",cat:"war"},
            {word:"Battle",def:"A specific fight within a larger war.",example:"The battle was fierce.",viDef:"M·ªôt cu·ªôc chi·∫øn ƒë·∫•u c·ª• th·ªÉ trong m·ªôt cu·ªôc chi·∫øn tranh l·ªõn h∆°n.",viExample:"Tr·∫≠n chi·∫øn ƒë√£ kh·ªëc li·ªát.",cat:"war"},
            {word:"Army",def:"A large organized group of soldiers.",example:"The army marched to the front.",viDef:"M·ªôt nh√≥m l·ªõn c√≥ t·ªï ch·ª©c c·ªßa nh·ªØng ng∆∞·ªùi l√≠nh.",viExample:"Qu√¢n ƒë·ªôi ƒë√£ h√†nh qu√¢n ra ti·ªÅn tuy·∫øn.",cat:"war"},
            {word:"Weapon",def:"A tool used for fighting.",example:"Soldiers carry weapons.",viDef:"M·ªôt c√¥ng c·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ chi·∫øn ƒë·∫•u.",viExample:"Ng∆∞·ªùi l√≠nh mang v≈© kh√≠.",cat:"war"}
          ],
          level2: [
            {word:"Strategy",def:"A plan for achieving victory.",example:"The strategy worked well.",viDef:"M·ªôt k·∫ø ho·∫°ch ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c chi·∫øn th·∫Øng.",viExample:"Chi·∫øn l∆∞·ª£c ƒë√£ ho·∫°t ƒë·ªông t·ªët.",cat:"war"},
            {word:"Tactics",def:"Specific techniques in battles.",example:"The tactics surprised the enemy.",viDef:"C√°c k·ªπ thu·∫≠t c·ª• th·ªÉ trong tr·∫≠n chi·∫øn.",viExample:"Chi·∫øn thu·∫≠t ƒë√£ l√†m b·∫•t ng·ªù k·∫ª th√π.",cat:"war"},
            {word:"Siege",def:"Surrounding a place to force surrender.",example:"The siege lasted months.",viDef:"Bao v√¢y m·ªôt n∆°i ƒë·ªÉ bu·ªôc ƒë·∫ßu h√†ng.",viExample:"Cu·ªôc bao v√¢y k√©o d√†i nhi·ªÅu th√°ng.",cat:"war"},
            {word:"Invasion",def:"Entering territory with military force.",example:"The invasion began at dawn.",viDef:"Nh·∫≠p v√†o l√£nh th·ªï v·ªõi l·ª±c l∆∞·ª£ng qu√¢n s·ª±.",viExample:"Cu·ªôc x√¢m l∆∞·ª£c b·∫Øt ƒë·∫ßu v√†o b√¨nh minh.",cat:"war"},
            {word:"Retreat",def:"Withdrawing from battle.",example:"The troops were ordered to retreat.",viDef:"R√∫t lui kh·ªèi tr·∫≠n chi·∫øn.",viExample:"Qu√¢n ƒë·ªôi ƒë∆∞·ª£c l·ªánh r√∫t lui.",cat:"war"}
          ],
          level3: [
            {word:"Attrition",def:"Wearing down the enemy over time.",example:"The war of attrition was costly.",viDef:"L√†m suy y·∫øu k·∫ª th√π theo th·ªùi gian.",viExample:"Cu·ªôc chi·∫øn tranh hao m√≤n r·∫•t t·ªën k√©m.",cat:"war"},
            {word:"Blitzkrieg",def:"A rapid overwhelming attack strategy.",example:"The blitzkrieg tactic was effective.",viDef:"M·ªôt chi·∫øn l∆∞·ª£c t·∫•n c√¥ng nhanh ch√≥ng √°p ƒë·∫£o.",viExample:"Chi·∫øn thu·∫≠t blitzkrieg ƒë√£ hi·ªáu qu·∫£.",cat:"war"},
            {word:"Guerrilla",def:"Irregular warfare using small groups.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"Chi·∫øn tranh kh√¥ng ƒë·ªÅu ƒë·∫∑n s·ª≠ d·ª•ng c√°c nh√≥m nh·ªè.",viExample:"C√°c chi·∫øn binh du k√≠ch ƒë√£ s·ª≠ d·ª•ng chi·∫øn thu·∫≠t ƒë√°nh v√† ch·∫°y.",cat:"war"},
            {word:"Insurgency",def:"An organized rebellion against authority.",example:"The insurgency grew stronger.",viDef:"M·ªôt cu·ªôc n·ªïi d·∫≠y c√≥ t·ªï ch·ª©c ch·ªëng l·∫°i ch√≠nh quy·ªÅn.",viExample:"Cu·ªôc n·ªïi d·∫≠y ng√†y c√†ng m·∫°nh h∆°n.",cat:"war"},
            {word:"Total war",def:"A war involving all societal resources.",example:"World War II was a total war.",viDef:"M·ªôt cu·ªôc chi·∫øn tranh li√™n quan ƒë·∫øn t·∫•t c·∫£ ngu·ªìn l·ª±c x√£ h·ªôi.",viExample:"Th·∫ø chi·∫øn II l√† m·ªôt cu·ªôc chi·∫øn tranh t·ªïng l·ª±c.",cat:"war"}
          ],
          finalBoss: [
            {word:"Armistice",def:"An agreement to stop fighting.",example:"The armistice ended the war.",viDef:"M·ªôt th·ªèa thu·∫≠n ƒë·ªÉ ng·ª´ng chi·∫øn ƒë·∫•u.",viExample:"Hi·ªáp ƒë·ªãnh ƒë√¨nh chi·∫øn ƒë√£ k·∫øt th√∫c cu·ªôc chi·∫øn.",cat:"war"},
            {word:"Siege",def:"A military operation surrounding a place.",example:"The siege of the city lasted a year.",viDef:"M·ªôt ho·∫°t ƒë·ªông qu√¢n s·ª± bao v√¢y m·ªôt n∆°i.",viExample:"Cu·ªôc bao v√¢y th√†nh ph·ªë k√©o d√†i m·ªôt nƒÉm.",cat:"war"},
            {word:"Guerrilla",def:"A member of an irregular fighting group.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"M·ªôt th√†nh vi√™n c·ªßa m·ªôt nh√≥m chi·∫øn ƒë·∫•u kh√¥ng ch√≠nh quy.",viExample:"C√°c chi·∫øn binh du k√≠ch ƒë√£ s·ª≠ d·ª•ng chi·∫øn thu·∫≠t ƒë√°nh v√† ch·∫°y.",cat:"war"},
            {word:"Reconnaissance",def:"Military observation of a region.",example:"The plane was on a reconnaissance mission.",viDef:"Quan s√°t qu√¢n s·ª± m·ªôt khu v·ª±c.",viExample:"Chi·∫øc m√°y bay ƒëang th·ª±c hi·ªán nhi·ªám v·ª• trinh s√°t.",cat:"war"},
            {word:"Battalion",def:"A large body of troops ready for battle.",example:"The battalion was sent to reinforce.",viDef:"M·ªôt l·ª±c l∆∞·ª£ng l·ªõn qu√¢n ƒë·ªôi s·∫µn s√†ng chi·∫øn ƒë·∫•u.",viExample:"Ti·ªÉu ƒëo√†n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ƒë·ªÉ tƒÉng c∆∞·ªùng.",cat:"war"}
          ]
        },
        medium: {
          level1: [
            {word:"Conflict",def:"A struggle or fight between groups.",example:"The conflict was resolved peacefully.",viDef:"M·ªôt cu·ªôc ƒë·∫•u tranh ho·∫∑c chi·∫øn ƒë·∫•u gi·ªØa c√°c nh√≥m.",viExample:"Cu·ªôc xung ƒë·ªôt ƒë√£ ƒë∆∞·ª£c gi·∫£i quy·∫øt m·ªôt c√°ch h√≤a b√¨nh.",cat:"war"},
            {word:"Combatant",def:"A person engaged in fighting.",example:"The combatants were heavily armed.",viDef:"M·ªôt ng∆∞·ªùi tham gia v√†o chi·∫øn ƒë·∫•u.",viExample:"Nh·ªØng ng∆∞·ªùi tham chi·∫øn ƒë∆∞·ª£c trang b·ªã v≈© kh√≠ h·∫°ng n·∫∑ng.",cat:"war"},
            {word:"Engagement",def:"A military encounter.",example:"The engagement was brief but intense.",viDef:"M·ªôt cu·ªôc ch·∫°m tr√°n qu√¢n s·ª±.",viExample:"Cu·ªôc ch·∫°m tr√°n ng·∫Øn ng·ªßi nh∆∞ng m√£nh li·ªát.",cat:"war"},
            {word:"Forces",def:"Organized military units.",example:"The forces were deployed to the region.",viDef:"C√°c ƒë∆°n v·ªã qu√¢n s·ª± c√≥ t·ªï ch·ª©c.",viExample:"C√°c l·ª±c l∆∞·ª£ng ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ƒë·∫øn khu v·ª±c.",cat:"war"},
            {word:"Ordnance",def:"Military weapons and ammunition.",example:"The ordnance depot was destroyed.",viDef:"V≈© kh√≠ v√† ƒë·∫°n d∆∞·ª£c qu√¢n s·ª±.",viExample:"Kho v≈© kh√≠ ƒë√£ b·ªã ph√° h·ªßy.",cat:"war"}
          ],
          level2: [
            {word:"Stratagem",def:"A clever plan to deceive the enemy.",example:"The stratagem worked perfectly.",viDef:"M·ªôt k·∫ø ho·∫°ch th√¥ng minh ƒë·ªÉ l·ª´a g·∫°t k·∫ª th√π.",viExample:"M∆∞u k·∫ø ƒë√£ ho·∫°t ƒë·ªông ho√†n h·∫£o.",cat:"war"},
            {word:"Ploys",def:"Tactical tricks to gain advantage.",example:"The commander used several ploys.",viDef:"Nh·ªØng m√°nh kh√≥e chi·∫øn thu·∫≠t ƒë·ªÉ gi√†nh l·ª£i th·∫ø.",viExample:"Ng∆∞·ªùi ch·ªâ huy ƒë√£ s·ª≠ d·ª•ng m·ªôt s·ªë m√°nh kh√≥e.",cat:"war"},
            {word:"Beleaguerment",def:"Surrounding a fortified position.",example:"The beleaguerment lasted for months.",viDef:"Bao v√¢y m·ªôt v·ªã tr√≠ ƒë∆∞·ª£c c·ªßng c·ªë.",viExample:"Cu·ªôc bao v√¢y ƒë√£ k√©o d√†i nhi·ªÅu th√°ng.",cat:"war"},
            {word:"Irruption",def:"A sudden violent invasion.",example:"The irruption caught them by surprise.",viDef:"M·ªôt cu·ªôc x√¢m l∆∞·ª£c ƒë·ªôt ng·ªôt b·∫°o l·ª±c.",viExample:"Cu·ªôc x√¢m nh·∫≠p ƒë·ªôt ng·ªôt ƒë√£ khi·∫øn h·ªç b·∫•t ng·ªù.",cat:"war"},
            {word:"Pullback",def:"Withdrawing forces strategically.",example:"The pullback was carefully planned.",viDef:"R√∫t l·ª±c l∆∞·ª£ng m·ªôt c√°ch chi·∫øn l∆∞·ª£c.",viExample:"Vi·ªác r√∫t lui ƒë∆∞·ª£c l√™n k·∫ø ho·∫°ch c·∫©n th·∫≠n.",cat:"war"}
          ],
          level3: [
            {word:"Erosion",def:"Gradual weakening of strength.",example:"The erosion of support was evident.",viDef:"S·ª± suy y·∫øu d·∫ßn d·∫ßn c·ªßa s·ª©c m·∫°nh.",viExample:"S·ª± x√≥i m√≤n s·ª± ·ªßng h·ªô l√† r√µ r√†ng.",cat:"war"},
            {word:"Rapid dominance",def:"Overwhelming an enemy quickly.",example:"The strategy of rapid dominance succeeded.",viDef:"√Åp ƒë·∫£o k·∫ª th√π m·ªôt c√°ch nhanh ch√≥ng.",viExample:"Chi·∫øn l∆∞·ª£c th·ªëng tr·ªã nhanh ch√≥ng ƒë√£ th√†nh c√¥ng.",cat:"war"},
            {word:"Partisan",def:"A member of a resistance group.",example:"Partisans operated behind enemy lines.",viDef:"M·ªôt th√†nh vi√™n c·ªßa m·ªôt nh√≥m kh√°ng chi·∫øn.",viExample:"C√°c du k√≠ch qu√¢n ho·∫°t ƒë·ªông ph√≠a sau chi·∫øn tuy·∫øn c·ªßa k·∫ª th√π.",cat:"war"},
            {word:"Uprising",def:"An armed revolt against authority.",example:"The uprising was brutally suppressed.",viDef:"M·ªôt cu·ªôc n·ªïi d·∫≠y v≈© trang ch·ªëng l·∫°i ch√≠nh quy·ªÅn.",viExample:"Cu·ªôc n·ªïi d·∫≠y ƒë√£ b·ªã ƒë√†n √°p t√†n b·∫°o.",cat:"war"},
            {word:"Total destruction",def:"Complete devastation of resources.",example:"The policy of total destruction was controversial.",viDef:"S·ª± h·ªßy di·ªát ho√†n to√†n t√†i nguy√™n.",viExample:"Ch√≠nh s√°ch h·ªßy di·ªát ho√†n to√†n ƒë√£ g√¢y tranh c√£i.",cat:"war"}
          ],
          finalBoss: [
            {word:"Armistice",def:"An agreement to stop fighting.",example:"The armistice ended the war.",viDef:"M·ªôt th·ªèa thu·∫≠n ƒë·ªÉ ng·ª´ng chi·∫øn ƒë·∫•u.",viExample:"Hi·ªáp ƒë·ªãnh ƒë√¨nh chi·∫øn ƒë√£ k·∫øt th√∫c cu·ªôc chi·∫øn.",cat:"war"},
            {word:"Siege",def:"A military operation surrounding a place.",example:"The siege of the city lasted a year.",viDef:"M·ªôt ho·∫°t ƒë·ªông qu√¢n s·ª± bao v√¢y m·ªôt n∆°i.",viExample:"Cu·ªôc bao v√¢y th√†nh ph·ªë k√©o d√†i m·ªôt nƒÉm.",cat:"war"},
            {word:"Guerrilla",def:"A member of an irregular fighting group.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"M·ªôt th√†nh vi√™n c·ªßa m·ªôt nh√≥m chi·∫øn ƒë·∫•u kh√¥ng ch√≠nh quy.",viExample:"C√°c chi·∫øn binh du k√≠ch ƒë√£ s·ª≠ d·ª•ng chi·∫øn thu·∫≠t ƒë√°nh v√† ch·∫°y.",cat:"war"},
            {word:"Reconnaissance",def:"Military observation of a region.",example:"The plane was on a reconnaissance mission.",viDef:"Quan s√°t qu√¢n s·ª± m·ªôt khu v·ª±c.",viExample:"Chi·∫øc m√°y bay ƒëang th·ª±c hi·ªán nhi·ªám v·ª• trinh s√°t.",cat:"war"},
            {word:"Battalion",def:"A large body of troops ready for battle.",example:"The battalion was sent to reinforce.",viDef:"M·ªôt l·ª±c l∆∞·ª£ng l·ªõn qu√¢n ƒë·ªôi s·∫µn s√†ng chi·∫øn ƒë·∫•u.",viExample:"Ti·ªÉu ƒëo√†n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ƒë·ªÉ tƒÉng c∆∞·ªùng.",cat:"war"}
          ]
        },
        hard: {
          level1: [
            {word:"Fight",def:"A physical confrontation.",example:"The fight was brief.",viDef:"M·ªôt cu·ªôc ƒë·ªëi ƒë·∫ßu v·∫≠t l√Ω.",viExample:"Cu·ªôc ·∫©u ƒë·∫£ l√† ng·∫Øn ng·ªßi.",cat:"war"},
            {word:"Warrior",def:"A skilled or experienced fighter.",example:"The ancient warriors were feared.",viDef:"M·ªôt ng∆∞·ªùi chi·∫øn ƒë·∫•u c√≥ k·ªπ nƒÉng ho·∫∑c kinh nghi·ªám.",viExample:"C√°c chi·∫øn binh c·ªï ƒë·∫°i ƒë∆∞·ª£c s·ª£ h√£i.",cat:"war"},
            {word:"Troops",def:"Groups of soldiers collectively.",example:"The troops were deployed quickly.",viDef:"C√°c nh√≥m ng∆∞·ªùi l√≠nh c√πng nhau.",viExample:"C√°c qu√¢n ƒë·ªôi ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai nhanh ch√≥ng.",cat:"war"},
            {word:"Arm",def:"A weapon or military equipment.",example:"The country began to arm its citizens.",viDef:"M·ªôt v≈© kh√≠ ho·∫∑c thi·∫øt b·ªã qu√¢n s·ª±.",viExample:"Qu·ªëc gia n√†y b·∫Øt ƒë·∫ßu trang b·ªã v≈© kh√≠ cho c√¥ng d√¢n.",cat:"war"},
            {word:"Triumph",def:"A significant victory.",example:"The triumph was celebrated nationwide.",viDef:"M·ªôt chi·∫øn th·∫Øng ƒë√°ng k·ªÉ.",viExample:"Chi·∫øn th·∫Øng ƒë√£ ƒë∆∞·ª£c ƒÉn m·ª´ng tr√™n to√†n qu·ªëc.",cat:"war"}
          ],
          level2: [
            {word:"Plan",def:"A detailed strategy or scheme.",example:"The general devised a new plan.",viDef:"M·ªôt chi·∫øn l∆∞·ª£c ho·∫∑c k·∫ø ho·∫°ch chi ti·∫øt.",viExample:"Ng∆∞·ªùi t∆∞·ªõng ƒë√£ nghƒ© ra m·ªôt k·∫ø ho·∫°ch m·ªõi.",cat:"war"},
            {word:"Maneuvers",def:"Planned movements of troops.",example:"The military maneuvers were impressive.",viDef:"C√°c cu·ªôc di chuy·ªÉn c√≥ k·∫ø ho·∫°ch c·ªßa qu√¢n ƒë·ªôi.",viExample:"C√°c cu·ªôc c∆° ƒë·ªông qu√¢n s·ª± ƒë√£ ·∫•n t∆∞·ª£ng.",cat:"war"},
            {word:"Incursion",def:"A sudden brief invasion.",example:"The incursion was repelled quickly.",viDef:"M·ªôt cu·ªôc x√¢m l∆∞·ª£c ƒë·ªôt ng·ªôt ng·∫Øn ng·ªßi.",viExample:"Cu·ªôc x√¢m nh·∫≠p ƒë√£ b·ªã ƒë·∫©y l√πi nhanh ch√≥ng.",cat:"war"},
            {word:"Withdrawal",def:"Pulling back forces from a position.",example:"The withdrawal was orderly.",viDef:"R√∫t l·ª±c l∆∞·ª£ng kh·ªèi m·ªôt v·ªã tr√≠.",viExample:"Vi·ªác r√∫t qu√¢n ƒë√£ c√≥ tr·∫≠t t·ª±.",cat:"war"},
            {word:"Embargo",def:"A restriction to weaken an enemy.",example:"The embargo crippled their economy.",viDef:"M·ªôt s·ª± h·∫°n ch·∫ø ƒë·ªÉ l√†m suy y·∫øu k·∫ª th√π.",viExample:"L·ªánh c·∫•m v·∫≠n ƒë√£ t√™ li·ªát n·ªÅn kinh t·∫ø c·ªßa h·ªç.",cat:"war"}
          ],
          level3: [
            {word:"Wearing down",def:"Reducing enemy strength over time.",example:"The strategy of wearing down proved effective.",viDef:"Gi·∫£m s·ª©c m·∫°nh k·∫ª th√π theo th·ªùi gian.",viExample:"Chi·∫øn l∆∞·ª£c l√†m suy y·∫øu ƒë√£ ƒë∆∞·ª£c ch·ª©ng minh l√† hi·ªáu qu·∫£.",cat:"war"},
            {word:"Lightning war",def:"A fast intense military campaign.",example:"The lightning war tactics were devastating.",viDef:"M·ªôt chi·∫øn d·ªãch qu√¢n s·ª± nhanh ch√≥ng c∆∞·ªùng ƒë·ªô cao.",viExample:"Chi·∫øn thu·∫≠t chi·∫øn tranh ch·ªõp nho√°ng ƒë√£ t√†n kh·ªëc.",cat:"war"},
            {word:"Irregular",def:"Fighters using non-traditional tactics.",example:"Irregular forces posed a constant threat.",viDef:"Nh·ªØng ng∆∞·ªùi chi·∫øn ƒë·∫•u s·ª≠ d·ª•ng c√°c chi·∫øn thu·∫≠t phi truy·ªÅn th·ªëng.",viExample:"L·ª±c l∆∞·ª£ng kh√¥ng ch√≠nh quy t·∫°o ra m·ªôt m·ªëi ƒëe d·ªça li√™n t·ª•c.",cat:"war"},
            {word:"Rebellion",def:"An armed revolt against authority.",example:"The rebellion was crushed within weeks.",viDef:"M·ªôt cu·ªôc n·ªïi d·∫≠y v≈© trang ch·ªëng l·∫°i ch√≠nh quy·ªÅn.",viExample:"Cu·ªôc n·ªïi d·∫≠y ƒë√£ b·ªã ƒë√†n √°p trong v√†i tu·∫ßn.",cat:"war"},
            {word:"All-out war",def:"A conflict mobilizing all resources.",example:"The nation prepared for all-out war.",viDef:"M·ªôt cu·ªôc xung ƒë·ªôt huy ƒë·ªông t·∫•t c·∫£ ngu·ªìn l·ª±c.",viExample:"Qu·ªëc gia n√†y ƒë√£ chu·∫©n b·ªã cho chi·∫øn tranh t·ªïng l·ª±c.",cat:"war"}
          ],
          finalBoss: [
            {word:"Armistice",def:"An agreement to stop fighting.",example:"The armistice ended the war.",viDef:"M·ªôt th·ªèa thu·∫≠n ƒë·ªÉ ng·ª´ng chi·∫øn ƒë·∫•u.",viExample:"Hi·ªáp ƒë·ªãnh ƒë√¨nh chi·∫øn ƒë√£ k·∫øt th√∫c cu·ªôc chi·∫øn.",cat:"war"},
            {word:"Siege",def:"A military operation surrounding a place.",example:"The siege of the city lasted a year.",viDef:"M·ªôt ho·∫°t ƒë·ªông qu√¢n s·ª± bao v√¢y m·ªôt n∆°i.",viExample:"Cu·ªôc bao v√¢y th√†nh ph·ªë k√©o d√†i m·ªôt nƒÉm.",cat:"war"},
            {word:"Guerrilla",def:"A member of an irregular fighting group.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"M·ªôt th√†nh vi√™n c·ªßa m·ªôt nh√≥m chi·∫øn ƒë·∫•u kh√¥ng ch√≠nh quy.",viExample:"C√°c chi·∫øn binh du k√≠ch ƒë√£ s·ª≠ d·ª•ng chi·∫øn thu·∫≠t ƒë√°nh v√† ch·∫°y.",cat:"war"},
            {word:"Reconnaissance",def:"Military observation of a region.",example:"The plane was on a reconnaissance mission.",viDef:"Quan s√°t qu√¢n s·ª± m·ªôt khu v·ª±c.",viExample:"Chi·∫øc m√°y bay ƒëang th·ª±c hi·ªán nhi·ªám v·ª• trinh s√°t.",cat:"war"},
            {word:"Battalion",def:"A large body of troops ready for battle.",example:"The battalion was sent to reinforce.",viDef:"M·ªôt l·ª±c l∆∞·ª£ng l·ªõn qu√¢n ƒë·ªôi s·∫µn s√†ng chi·∫øn ƒë·∫•u.",viExample:"Ti·ªÉu ƒëo√†n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ƒë·ªÉ tƒÉng c∆∞·ªùng.",cat:"war"}
          ]
        }
      };
      vocabLoaded = true;
      
      if (loadingIndicator) {
        loadingIndicator.classList.remove('active');
      }
    }
  })();
  
  return vocabLoadingPromise;
}

/* ===== local storage helpers ===== */
let state = {
  currentLevel: 1,
  health: 100,
  armyStrength: 0,
  levelProgress: { correct: 0, total: 5 }, // level1: 5, level2: 7, level3: 10, finalBoss: 10/12
  badges: [],
  learnedWords: [],
  combo: 0,
  difficulty: 'easy',
  soundEnabled: true
};
function loadState(){
  let s = localStorage.getItem('wb_state');
  if(s) try{state=Object.assign(state,JSON.parse(s));}catch(e){}
}
function saveState(){localStorage.setItem('wb_state',JSON.stringify(state));updateHUD();updateBarracks();}
loadState();

/* ===== HUD & UI wiring ===== */
function updateHUD(){
  document.getElementById('score').innerText = (LANG==='en'? 'Army: ' : 'Qu√¢n ƒë·ªôi: ') + state.armyStrength;
  document.getElementById('level').innerText = state.currentLevel;
  document.getElementById('health').innerText = state.health;
  document.getElementById('healthPercent').innerText = state.health + '%';
  document.getElementById('healthBar').style.width = state.health + '%';
  document.getElementById('strengthValue').innerText = state.armyStrength;
  document.getElementById('strengthBar').style.width = Math.min(state.armyStrength, 100) + '%';
  
  // Update level info
  let levelNames = {
    1: t('level1'),
    2: t('level2'),
    3: t('level3'),
    4: t('finalBoss')
  };
  document.getElementById('currentLevel').innerText = levelNames[state.currentLevel];
  
  // Update progress
  let progress = (state.levelProgress.correct / state.levelProgress.total) * 100;
  document.getElementById('levelProgress').style.width = progress + '%';
  document.getElementById('progressText').innerText = state.levelProgress.correct + '/' + state.levelProgress.total;
  
  // Update badges
  updateBadges();
  
  // Update army visualization
  updateArmyVisualization();
}

function updateBadges() {
  const badgesContainer = document.getElementById('badgesContainer');
  badgesContainer.innerHTML = '';
  
  if (state.badges.length === 0) {
    badgesContainer.innerHTML = `<div class="badge" style="background:#555">${t('noBadges')}</div>`;
    return;
  }
  
  const badgeNames = {
    'strategist': LANG === 'en' ? 'The Strategist' : 'Nh√† chi·∫øn l∆∞·ª£c',
    'commander': LANG === 'en' ? 'The Commander' : 'Ch·ªâ huy',
    'conqueror': LANG === 'en' ? 'The Conqueror' : 'Ng∆∞·ªùi chinh ph·ª•c',
    'combo': LANG === 'en' ? 'Combo Master' : 'B·∫≠c th·∫ßy Combo'
  };
  
  state.badges.forEach(badge => {
    const badgeEl = document.createElement('div');
    badgeEl.className = 'badge';
    badgeEl.innerText = badgeNames[badge] || badge;
    badgesContainer.appendChild(badgeEl);
  });
}

function updateBarracks() {
  const barracksContent = document.getElementById('barracksContent');
  
  if (state.learnedWords.length === 0) {
    barracksContent.innerHTML = `<p style="color:var(--muted)">${t('barracksEmpty')}</p>`;
    return;
  }
  
  barracksContent.innerHTML = '<h4>Your Vocabulary Army:</h4>';
  
  const wordsList = document.createElement('div');
  wordsList.style.display = 'flex';
  wordsList.style.flexWrap = 'wrap';
  wordsList.style.gap = '8px';
  wordsList.style.marginTop = '10px';
  
  state.learnedWords.forEach(word => {
    const wordEl = document.createElement('div');
    wordEl.style.padding = '5px 10px';
    wordEl.style.background = 'rgba(138,194,73,0.2)';
    wordEl.style.borderRadius = '15px';
    wordEl.style.fontSize = '14px';
    wordEl.innerText = word;
    wordsList.appendChild(wordEl);
  });
  
  barracksContent.appendChild(wordsList);
}

function updateArmyVisualization() {
  const armyContainer = document.getElementById('armyContainer');
  armyContainer.innerHTML = '';
  
  // Add soldiers based on army strength (1 soldier per 10 strength)
  const soldierCount = Math.min(Math.floor(state.armyStrength / 10), 20);
  
  for (let i = 0; i < soldierCount; i++) {
    const soldier = document.createElement('div');
    soldier.className = 'soldier';
    soldier.innerText = 'ü™ñ';
    armyContainer.appendChild(soldier);
  }
}

function showFeedbackMessage(message, type) {
  const feedbackEl = document.getElementById('feedbackMessage');
  feedbackEl.innerText = message;
  feedbackEl.className = 'feedback-message feedback-' + type;
  feedbackEl.style.opacity = '1';
  
  // Add shake effect for wrong answers
  if (type === 'wrong') {
    document.getElementById('battleArea').classList.add('shake');
    setTimeout(() => {
      document.getElementById('battleArea').classList.remove('shake');
    }, 500);
  }
  
  // Add pulse effect for correct answers
  if (type === 'correct' || type === 'combo') {
    document.getElementById('battleArea').classList.add('pulse');
    setTimeout(() => {
      document.getElementById('battleArea').classList.remove('pulse');
    }, 500);
  }
  
  setTimeout(() => {
    feedbackEl.style.opacity = '0';
  }, 1500);
}

function updateCombo() {
  const comboCounter = document.getElementById('comboCounter');
  const comboValue = document.getElementById('comboValue');
  
  if (state.combo > 1) {
    comboCounter.classList.add('active');
    comboValue.innerText = state.combo;
    
    // Show combo message
    if (state.combo === 2) {
      showFeedbackMessage(t('combo2'), 'combo');
    } else if (state.combo === 3) {
      showFeedbackMessage(t('combo3'), 'combo');
    } else if (state.combo >= 5) {
      showFeedbackMessage(t('combo5'), 'combo');
    }
  } else {
    comboCounter.classList.remove('active');
  }
}

const views = {battle:document.getElementById('view-battle'),barracks:document.getElementById('view-barracks'),edit:document.getElementById('view-edit')};
const btnBattle=document.getElementById('btn-battle'),btnBarracks=document.getElementById('btn-barracks'),btnEdit=document.getElementById('btn-edit');
btnBattle.onclick=()=>show('battle');btnBarracks.onclick=()=>show('barracks');btnEdit.onclick=()=>show('edit');
function show(v){
  for(let k in views){views[k].style.display='none';}
  btnBattle.classList.remove('active');btnBarracks.classList.remove('active');btnEdit.classList.remove('active');
  if(v==='battle'){views.battle.style.display='block';btnBattle.classList.add('active'); stopTimer(); resetBattleArea();}
  if(v==='barracks'){views.barracks.style.display='block';btnBarracks.classList.add('active'); updateBarracks();}
  if(v==='edit'){views.edit.style.display='block';btnEdit.classList.add('active');document.getElementById('vocabJson').value = JSON.stringify(vocab,null,2)}
}

/* ===== language toggles ===== */
document.getElementById('langEn').onclick=()=>{LANG='en';applyLang();};
document.getElementById('langVi').onclick=()=>{LANG='vi';applyLang();};
function applyLang(){
  document.getElementById('btn-battle').innerText = STRINGS[LANG].battle;
  document.getElementById('btn-barracks').innerText = STRINGS[LANG].barracks;
  document.getElementById('btn-edit').innerText = STRINGS[LANG].edit;
  document.getElementById('footer').innerText = STRINGS[LANG].tip;
  document.getElementById('btn-help').onclick = ()=>alert(STRINGS[LANG].how + '\n\n' + STRINGS[LANG].scoring);
  document.getElementById('nextBattle').innerText = STRINGS[LANG].startBattle;
  document.getElementById('questionText').innerText = STRINGS[LANG].pressStart;
  document.querySelector('.difficulty-selector .small').innerText = STRINGS[LANG].vocabSet;
  document.querySelectorAll('.difficulty-btn').forEach((btn, index) => {
    btn.innerText = ['basic', 'advanced', 'expert'].map(key => STRINGS[LANG][key])[index];
  });
  updateHUD();
}

/* ===== vocabulary set selector ===== */
document.querySelectorAll('.difficulty-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    state.difficulty = this.dataset.diff;
    saveState();
  });
});

/* ===== small controls ===== */
document.getElementById('btn-reset').onclick=()=>{
  if(confirm(LANG==='en'? 'Reset all progress and start over?':'B·∫°n c√≥ ch·∫Øc mu·ªën ƒë·∫∑t l·∫°i ti·∫øn tr√¨nh v√† b·∫Øt ƒë·∫ßu l·∫°i?')){
    localStorage.removeItem('wb_state');
    state = {
      currentLevel: 1,
      health: 100,
      armyStrength: 0,
      levelProgress: { correct: 0, total: 5 },
      badges: [],
      learnedWords: [],
      combo: 0,
      difficulty: 'easy',
      soundEnabled: true
    };
    saveState();
    alert(LANG==='en'? 'Game reset. Good luck, Commander!' : 'ƒê√£ ƒë·∫∑t l·∫°i tr√≤ ch∆°i. Ch√∫c may m·∫Øn, Ch·ªâ huy!');
  }
};
document.getElementById('btn-help').onclick=()=>alert(STRINGS[LANG].how + '\n\n' + STRINGS[LANG].scoring);

/* ===== battle logic ===== */
let battleTimerId=null;let battleTime=20;let currentQ=null;let answerSelected=false;
function pickQuestion(level){
  if (!vocab || !vocab[state.difficulty]) {
    console.error('Vocabulary not loaded or difficulty not found');
    return null;
  }
  
  let pool;
  if(level === 4) {
    pool = vocab[state.difficulty].finalBoss;
  } else {
    let levelKey = 'level' + level;
    pool = vocab[state.difficulty][levelKey];
  }
  
  if(!pool || pool.length === 0) return null;
  let correct = pool[Math.floor(Math.random()*pool.length)];
  let options = [correct];

  // Try to add up to 3 unique distractors from the same pool,
  // but protect against infinite loops when pool has <4 items.
  let attempts = 0;
  const maxAttempts = 100;
  while (options.length < 4 && attempts < maxAttempts) {
    attempts++;
    let cand = pool[Math.floor(Math.random() * pool.length)];
    if (!options.find(o => o.word === cand.word)) options.push(cand);
  }

  // If we still don't have enough options, pull from other levels in the same difficulty
  if (options.length < 4) {
    const otherCandidates = [];
    for (let k in vocab[state.difficulty]) {
      if (Array.isArray(vocab[state.difficulty][k])) {
        vocab[state.difficulty][k].forEach(it => {
          if (it.word !== correct.word && !options.find(o => o.word === it.word)) {
            otherCandidates.push(it);
          }
        });
      }
    }
    // add from the collected pool
    for (let i = 0; i < otherCandidates.length && options.length < 4; i++) {
      options.push(otherCandidates[i]);
    }
  }

  // If still not enough (very small vocab), fill with placeholders (non-blocking fallback)
  while (options.length < 4) {
    options.push({ word: '__', def: LANG === 'en' ? '‚Äî' : '‚Äî' });
  }

  // Shuffle options
  for(let i=options.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[options[i],options[j]]=[options[j],options[i]]}
  return {q:correct,options};
}

document.getElementById('nextBattle').onclick=()=>startBattle();
async function startBattle(){
  // Disable the button during loading
  const startButton = document.getElementById('nextBattle');
  startButton.disabled = true;
  startButton.innerText = LANG === 'en' ? 'Loading...' : 'ƒêang t·∫£i...';
  
  try {
    // Make sure vocabulary is loaded
    if (!vocabLoaded) {
      await loadVocabulary();
    }
    
    if (!vocab || !vocab[state.difficulty]) {
      alert(LANG === 'en' ? 'Vocabulary not available. Please try again later.' : 'T·ª´ v·ª±ng kh√¥ng kh·∫£ d·ª•ng. Vui l√≤ng th·ª≠ l·∫°i sau.');
      return;
    }
    
    stopTimer();
    resetBattleArea();
    
    let q = pickQuestion(state.currentLevel);
    if(!q){
      document.getElementById('questionText').innerText=(LANG==='en'? 'No words available for this level.' : 'Kh√¥ng c√≥ t·ª´ n√†o cho c·∫•p ƒë·ªô n√†y.');
      return;
    }
    
    currentQ=q;
    answerSelected = false;
    document.getElementById('questionText').innerText = (LANG==='en'? 'What is the meaning of: "' : 'Nghƒ©a c·ªßa t·ª´ l√†: "') + q.q.word + '"?';
    let opts = document.getElementById('options');opts.innerHTML='';
    
    q.options.forEach(o=>{
      let b = document.createElement('div');
      b.className='option';
      b.innerText=o.def;
      b.onclick=()=>selectOption(b,o);
      opts.appendChild(b);
    });
    
    // Change button text to "Continue"
    startButton.innerText = STRINGS[LANG].continueBattle;
    startButton.disabled = false;
    
    // Set timer based on difficulty
    let timeLimit = 20;
    if (state.difficulty === 'medium') timeLimit = 15;
    if (state.difficulty === 'hard') timeLimit = 10;
    
    battleTime=timeLimit;
    document.getElementById('timer').innerText=battleTime+'s';
    battleTimerId=setInterval(()=>{
      battleTime--;
      document.getElementById('timer').innerText=battleTime+'s';
      if(battleTime<=0){
        stopTimer();
        revealAnswer(null);
      }
    },1000);
  } catch (error) {
    console.error('Error starting battle:', error);
    alert(LANG === 'en' ? 'Error starting battle. Please try again.' : 'L·ªói b·∫Øt ƒë·∫ßu tr·∫≠n chi·∫øn. Vui l√≤ng th·ª≠ l·∫°i.');
    startButton.innerText = STRINGS[LANG].startBattle;
    startButton.disabled = false;
  }
}

function resetBattleArea() {
  document.getElementById('questionText').innerText = STRINGS[LANG].pressStart;
  document.getElementById('options').innerHTML = '';
  document.getElementById('timer').innerText = '--';
  currentQ = null;
  answerSelected = false;
  
  // Reset button text to "Start Battle"
  const startButton = document.getElementById('nextBattle');
  startButton.innerText = STRINGS[LANG].startBattle;
  startButton.disabled = false;
}

function stopTimer(){
  if(battleTimerId)clearInterval(battleTimerId);
  battleTimerId=null;
  document.getElementById('timer').innerText='--';
}

function selectOption(el,opt){
  // Prevent multiple clicks on the same question
  if (answerSelected) return;
  answerSelected = true;
  
  stopTimer();
  if(!currentQ) return;
  
  let correct = currentQ.q.word===opt.word;
  if(correct){
    el.classList.add('correct');
    onCorrect();
  } else {
    el.classList.add('wrong');
    onWrong();
    revealAnswer(opt);
  }
  
  // Show correct answer
  let opts = document.querySelectorAll('.option');
  opts.forEach(o=>{
    if(o.innerText===currentQ.q.def) o.classList.add('correct');
  });
}

function revealAnswer(selected){
  if(!currentQ) return;
  
  let area = document.getElementById('questionText');
  let example = LANG==='en'? currentQ.q.example : currentQ.q.viExample;
  area.innerText = (LANG==='en'? 'Word: ' : 'T·ª´: ') + currentQ.q.word + 
                 '\n' + (LANG==='en'? 'Definition: ' : 'ƒê·ªãnh nghƒ©a: ') + currentQ.q.def + 
                 '\n' + (LANG==='en'? 'Example: ' : 'V√≠ d·ª•: ') + example;
}

function onCorrect(){
  // Show feedback
  showFeedbackMessage(t('correct'), 'correct');
  
  // Increase combo
  state.combo++;
  updateCombo();
  
  // Calculate points based on combo
  let points = 10;
  if (state.combo >= 2) points += 5;
  if (state.combo >= 3) points += 5;
  if (state.combo >= 5) points += 5;
  
  state.armyStrength += points;
  state.levelProgress.correct++;
  
  // Add word to learned words if not already there
  if(!state.learnedWords.includes(currentQ.q.word)){
    state.learnedWords.push(currentQ.q.word);
  }
  
  // Check if level is complete
  if(state.currentLevel === 4) {
    // Final boss - special handling
    if(state.levelProgress.correct >= 10) {
      // Player wins the game
      showLevelComplete();
    }
  } else if(state.levelProgress.correct >= state.levelProgress.total) {
    // Regular level complete
    showLevelComplete();
  }
  
  saveState();
}

function onWrong(){
  // Show feedback
  showFeedbackMessage(t('wrong'), 'wrong');
  
  // Reset combo
  state.combo = 0;
  updateCombo();
  
  // Reduce health and army strength
  state.health -= 5;
  state.armyStrength = Math.max(0, state.armyStrength - 3);
  
  if(state.health <= 0) {
    state.health = 0;
    saveState();
    showGameOver();
  } else {
    saveState();
  }
}

function showGameOver() {
  document.getElementById('gameOverTitle').innerText = STRINGS[LANG].gameOver;
  document.getElementById('gameOverMessage').innerText = STRINGS[LANG].gameOverMsg;
  document.getElementById('restartBtn').innerText = STRINGS[LANG].restart;
  document.getElementById('gameOverModal').style.display = 'flex';
}

function showLevelComplete() {
  let badge = '';
  let title = '';
  
  if(state.currentLevel === 1) {
    badge = 'strategist';
    title = LANG === 'en' ? 'The Strategist' : 'Nh√† chi·∫øn l∆∞·ª£c';
  } else if(state.currentLevel === 2) {
    badge = 'commander';
    title = LANG === 'en' ? 'The Commander' : 'Ch·ªâ huy';
  } else if(state.currentLevel === 3) {
    badge = 'conqueror';
    title = LANG === 'en' ? 'The Conqueror' : 'Ng∆∞·ªùi chinh ph·ª•c';
  } else if(state.currentLevel === 4) {
    // Final boss completed - game won
    document.getElementById('levelCompleteTitle').innerText = LANG === 'en' ? 'Victory!' : 'Chi·∫øn th·∫Øng!';
    document.getElementById('levelCompleteMessage').innerText = LANG === 'en' ? 
      'Congratulations! You have conquered the Word Battlefield and become a master of war vocabulary!' : 
      'Ch√∫c m·ª´ng! B·∫°n ƒë√£ chinh ph·ª•c Chi·∫øn tr∆∞·ªùng T·ª´ v·ª±ng v√† tr·ªü th√†nh b·∫≠c th·∫ßy t·ª´ v·ª±ng chi·∫øn tranh!';
    document.getElementById('nextLevelBtn').innerText = LANG === 'en' ? 'Play Again' : 'Ch∆°i l·∫°i';
    document.getElementById('levelCompleteModal').style.display = 'flex';
    return;
  }
  
  // Add badge if not already earned
  if(!state.badges.includes(badge)) {
    state.badges.push(badge);
  }
  
  // Add combo badge if player achieved high combo
  if(state.combo >= 5 && !state.badges.includes('combo')) {
    state.badges.push('combo');
  }
  
  document.getElementById('levelCompleteTitle').innerText = STRINGS[LANG].levelComplete;
  document.getElementById('levelCompleteMessage').innerText = STRINGS[LANG].levelCompleteMsg + ' ' + 
    (LANG === 'en' ? `You've earned the "${title}" badge!` : `B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c huy hi·ªáu "${title}"!`);
  document.getElementById('nextLevelBtn').innerText = STRINGS[LANG].nextLevel;
  document.getElementById('levelCompleteModal').style.display = 'flex';
}

function nextLevel() {
  document.getElementById('levelCompleteModal').style.display = 'none';
  
  if(state.currentLevel === 4) {
    // Game completed - restart
    document.getElementById('btn-reset').click();
    return;
  }
  
  // Move to next level
  state.currentLevel++;
  
  // Set level progress requirements
  if(state.currentLevel === 2) {
    state.levelProgress = { correct: 0, total: 7 };
  } else if(state.currentLevel === 3) {
    state.levelProgress = { correct: 0, total: 10 };
  } else if(state.currentLevel === 4) {
    state.levelProgress = { correct: 0, total: 12 };
  }
  
  saveState();
  resetBattleArea();
}

// Modal event listeners
document.getElementById('restartBtn').onclick = function() {
  document.getElementById('gameOverModal').style.display = 'none';
  document.getElementById('btn-reset').click();
};

document.getElementById('nextLevelBtn').onclick = nextLevel;

/* ===== edit & save vocab ===== */
document.getElementById('saveVocab').onclick=()=>{
  try{
    let j = JSON.parse(document.getElementById('vocabJson').value);
    if(!j.easy || !j.medium || !j.hard) {
      throw (LANG==='en' ? 'Vocabulary must include easy, medium, and hard sets' : 'T·ª´ v·ª±ng ph·∫£i bao g·ªìm c√°c b·ªô d·ªÖ, trung b√¨nh v√† kh√≥');
    }
    
    vocab = j;
    localStorage.setItem('wb_vocab', JSON.stringify(vocab));
    alert(LANG==='en'? 'Saved successfully!' : 'ƒê√£ l∆∞u th√†nh c√¥ng!');
  } catch(e){
    alert((LANG==='en'? 'Error: ' : 'L·ªói: ') + e);
  }
};

document.getElementById('resetVocab').onclick=()=>{
  if(confirm(LANG==='en'? 'Reset vocabulary to default?':'B·∫°n c√≥ mu·ªën ƒë·∫∑t l·∫°i danh s√°ch t·ª´ v·ªÅ m·∫∑c ƒë·ªãnh?')){
    localStorage.removeItem('wb_vocab');
    vocabLoaded = false; // Reset vocab loaded flag
    loadVocabulary().then(() => {
      document.getElementById('vocabJson').value = JSON.stringify(vocab, null, 2);
      alert(LANG==='en'? 'Reset to default.' : 'ƒê√£ ƒë·∫∑t l·∫°i m·∫∑c ƒë·ªãnh.');
    });
  }
};

/* ===== init ===== */
async function init() {
  try {
    await loadVocabulary();
    updateHUD();
    updateBarracks();
    document.getElementById('vocabJson').value = JSON.stringify(vocab, null, 2);
  } catch (error) {
    console.error('Initialization error:', error);
  }
}

// Initialize the game when the page loads
document.addEventListener('DOMContentLoaded', init);

/* ===== download handler ===== */
document.getElementById('downloadBtn').addEventListener('click', (e)=>{
  const blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  e.currentTarget.href = url;
});
</script>
</body>
</html>
