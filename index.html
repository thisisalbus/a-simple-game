<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Battlefield â€” War Vocabulary Game</title>
  <style>
    :root{--bg:#1a1f1a;--card:#0f130f;--accent:#8ac249;--accent2:#c19a6b;--muted:#a39b8d;--danger:#c0392b;--warning:#f39c12}
    *{box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0d0d0d 0%, #1a1a1a 60%);color:#e6eef8}
    .container{max-width:1100px;margin:26px auto;padding:22px}
    header{display:flex;align-items:center;gap:18px}
    .logo{width:68px;height:68px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#04263b;font-size:26px;box-shadow:0 8px 30px rgba(6,12,24,.6)}
    h1{margin:0;font-size:22px}
    p.lead{margin-top:6px;color:var(--muted)}
    .main{display:grid;grid-template-columns:340px 1fr;gap:18px;margin-top:18px}

    /* left panel */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    .menu button{display:block;width:100%;padding:12px;border-radius:10px;border:0;background:transparent;color:inherit;text-align:left;margin-bottom:8px;font-weight:600;cursor:pointer}
    .menu button.active{background:rgba(255,255,255,0.03);box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}
    .score{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
    .score .big{font-size:28px;font-weight:800}
    .small{color:var(--muted);font-size:13px}

    /* right content */
    .content{min-height:420px;padding:18px;border-radius:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px}
    .controls{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    .btn{background:linear-gradient(90deg,var(--accent2),var(--accent));padding:10px 14px;border-radius:10px;border:0;color:#04263b;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:10px}

    /* quiz */
    .question{font-size:20px;font-weight:700;margin:12px 0}
    .options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .option{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid transparent}
    .option:hover{transform:translateY(-3px)}
    .option.correct{outline:3px solid rgba(138,194,73,0.14);background:linear-gradient(90deg, rgba(138,194,73,0.04), rgba(193,154,107,0.02));}
    .option.wrong{outline:3px solid rgba(192,57,43,0.12);opacity:.9}

    /* level progress */
    .level-progress{margin-top:15px}
    .progress-bar{height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden;margin-top:5px}
    .progress-fill{height:100%;background:var(--accent);border-radius:5px;transition:width 0.3s ease}
    
    /* health & strength bars */
    .stat-bars{display:flex;gap:15px;margin-top:15px}
    .stat-bar{flex:1}
    .stat-label{display:flex;justify-content:space-between;margin-bottom:5px;font-size:14px}
    .bar-container{height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden}
    .health-fill{height:100%;background:var(--danger);border-radius:5px;transition:width 0.3s ease}
    .strength-fill{height:100%;background:var(--warning);border-radius:5px;transition:width 0.3s ease}
    
    /* level indicator */
    .level-indicator{display:flex;align-items:center;gap:10px;margin-bottom:15px}
    .level-badge{padding:5px 10px;background:var(--accent);color:#000;border-radius:20px;font-weight:bold;font-size:14px}
    
    /* badges */
    .badges{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}
    .badge{padding:5px 10px;background:var(--accent2);color:#000;border-radius:20px;font-size:12px;font-weight:bold}
    
    /* game over modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
    .modal-content{background:var(--card);padding:25px;border-radius:12px;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center}
    .modal-header{font-size:24px;font-weight:700;margin-bottom:15px;color:var(--accent)}
    .modal-body{margin-bottom:20px}
    .modal-buttons{display:flex;gap:10px;justify-content:center}

    /* responsive */
    @media(max-width:900px){.main{grid-template-columns:1fr;}.logo{width:58px;height:58px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">âš”ï¸</div>
      <div style="flex:1">
        <h1 id="title">Word Battlefield â€” War Vocabulary Game</h1>
        <p class="lead" id="lead">Build your vocabulary army to defeat the enemy! Learn war-related terms through strategic battles.</p>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <div style="display:flex;gap:6px">
          <button id="langEn" class="ghost">EN</button>
          <button id="langVi" class="ghost">VI</button>
        </div>
        <a id="downloadBtn" class="btn" href="#" download="word-battlefield.html">Download HTML</a>
      </div>
    </header>

    <div class="main">
      <aside class="panel">
        <div class="menu">
          <button id="btn-battle" class="active">âš”ï¸ Battle</button>
          <button id="btn-barracks">ğŸ° Barracks</button>
          <button id="btn-edit">âœï¸ Edit Words</button>
        </div>

        <div class="score">
          <div class="big" id="score">Army: 0</div>
          <div class="small">Level: <span id="level">1</span> â€¢ Health: <span id="health">100</span></div>
        </div>

        <div class="stat-bars">
          <div class="stat-bar">
            <div class="stat-label">
              <span>Health</span>
              <span id="healthPercent">100%</span>
            </div>
            <div class="bar-container">
              <div id="healthBar" class="health-fill" style="width:100%"></div>
            </div>
          </div>
          <div class="stat-bar">
            <div class="stat-label">
              <span>Army Strength</span>
              <span id="strengthValue">0</span>
            </div>
            <div class="bar-container">
              <div id="strengthBar" class="strength-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <div class="level-progress">
          <div class="level-indicator">
            <span>Current Mission:</span>
            <div id="currentLevel" class="level-badge">Level 1: Boot Camp</div>
          </div>
          <div class="progress-bar">
            <div id="levelProgress" class="progress-fill" style="width:0%"></div>
          </div>
          <div class="small" style="margin-top:5px">Progress: <span id="progressText">0/5</span></div>
        </div>

        <div class="badges" id="badgesContainer">
          <div class="badge" style="background:#555">No Badges Yet</div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;">
          <button id="btn-reset" class="ghost">Reset Game</button>
          <button id="btn-help" class="ghost">How to Play</button>
        </div>
      </aside>

      <section class="content">
        <div id="view-battle" class="card">
          <div class="controls">
            <button id="nextBattle" class="btn">Start Battle</button>
            <div style="margin-left:auto" class="small">Timer: <span id="timer">--</span></div>
          </div>
          <div id="battleArea">
            <div class="question" id="questionText">Press "Start Battle" to begin your first mission!</div>
            <div class="options" id="options"></div>
          </div>
        </div>

        <div id="view-barracks" class="card" style="margin-top:12px;display:none">
          <div class="small">Your barracks. Here you can review the vocabulary you've learned and prepare for battle.</div>
          <div style="margin-top:15px">
            <h3 style="margin-top:0">Your Vocabulary Army</h3>
            <div id="barracksContent" style="margin-top:10px">
              <p style="color:var(--muted)">Complete battles to unlock words in your barracks.</p>
            </div>
          </div>
        </div>

        <div id="view-edit" class="card" style="margin-top:12px;display:none">
          <div class="small">Edit the vocabulary list (JSON). Structure: {"level1":[...], "level2":[...], "level3":[...], "finalBoss":[...]}</div>
          <textarea id="vocabJson" style="width:100%;height:260px;margin-top:8px;border-radius:8px;padding:10px;background:#031524;color:#ccdef7;border:1px solid rgba(255,255,255,0.03);"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="saveVocab" class="btn">Save</button>
            <button id="resetVocab" class="ghost">Reset to Default</button>
          </div>
        </div>

      </section>
    </div>

    <footer id="footer">Build your vocabulary army to conquer the battlefield! Complete all missions to become a Word Commander.</footer>
  </div>

  <!-- Game Over Modal -->
  <div id="gameOverModal" class="modal">
    <div class="modal-content">
      <div class="modal-header" id="gameOverTitle">Game Over</div>
      <div class="modal-body" id="gameOverMessage">
        Your army has been defeated. Try again to build a stronger vocabulary force!
      </div>
      <div class="modal-buttons">
        <button id="restartBtn" class="btn">Restart Game</button>
      </div>
    </div>
  </div>

  <!-- Level Complete Modal -->
  <div id="levelCompleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header" id="levelCompleteTitle">Mission Complete!</div>
      <div class="modal-body" id="levelCompleteMessage">
        You've successfully completed this mission. Your army grows stronger!
      </div>
      <div class="modal-buttons">
        <button id="nextLevelBtn" class="btn">Next Mission</button>
      </div>
    </div>
  </div>

<script>
/* ===== language & strings ===== */
let LANG='en';
const STRINGS = {
  en: {
    battle:'âš”ï¸ Battle', barracks:'ğŸ° Barracks', edit:'âœï¸ Edit Words',
    tip:'Build your vocabulary army to conquer the battlefield! Complete all missions to become a Word Commander.',
    how: `Word Battlefield - War Vocabulary Game

How to Play:
1. Start at Level 1 (Boot Camp) and progress through missions.
2. Each battle presents a war-related vocabulary word.
3. Choose the correct definition from 4 options.
4. Correct answers strengthen your army (+10 strength).
5. Wrong answers reduce your health (-5 health).
6. Complete each level by answering the required number of questions correctly.
7. Earn badges for completing missions: The Strategist, The Commander, The Conqueror.
8. Defeat the Final Boss to win the game!

Game Over: If your health reaches 0, your army is defeated.

Good luck, Commander!`,
    scoring: `Scoring System:
â€¢ Correct answer: +10 Army Strength
â€¢ Wrong answer: -5 Health
â€¢ Level 1: Complete 5 correct answers
â€¢ Level 2: Complete 7 correct answers
â€¢ Level 3: Complete 10 correct answers
â€¢ Final Boss: Get 10 out of 12 questions correct
â€¢ Badges: Earned for completing each level`,
    level1: "Level 1: Boot Camp",
    level2: "Level 2: Battlefield",
    level3: "Level 3: Campaign",
    finalBoss: "Final Boss: Ultimate Battle",
    gameOver: "Game Over",
    gameOverMsg: "Your army has been defeated. Try again to build a stronger vocabulary force!",
    levelComplete: "Mission Complete!",
    levelCompleteMsg: "You've successfully completed this mission. Your army grows stronger!",
    restart: "Restart Game",
    nextLevel: "Next Mission",
    noBadges: "No Badges Yet",
    barracksEmpty: "Complete battles to unlock words in your barracks.",
    startBattle: "Start Battle",
    pressStart: "Press \"Start Battle\" to begin your first mission!"
  },
  vi: {
    battle:'âš”ï¸ Tráº­n chiáº¿n', barracks:'ğŸ° Doanh tráº¡i', edit:'âœï¸ Chá»‰nh sá»­a tá»«',
    tip:'XÃ¢y dá»±ng Ä‘á»™i quÃ¢n tá»« vá»±ng Ä‘á»ƒ chinh phá»¥c chiáº¿n trÆ°á»ng! HoÃ n thÃ nh táº¥t cáº£ nhiá»‡m vá»¥ Ä‘á»ƒ trá»Ÿ thÃ nh Chá»‰ huy tá»« vá»±ng.',
    how: `Chiáº¿n trÆ°á»ng Tá»« vá»±ng - TrÃ² chÆ¡i Tá»« vá»±ng Chá»§ Ä‘á» Chiáº¿n tranh

CÃ¡ch chÆ¡i:
1. Báº¯t Ä‘áº§u á»Ÿ Cáº¥p Ä‘á»™ 1 (Tráº¡i lÃ­nh) vÃ  tiáº¿n hÃ nh cÃ¡c nhiá»‡m vá»¥.
2. Má»—i tráº­n chiáº¿n Ä‘Æ°a ra má»™t tá»« vá»±ng liÃªn quan Ä‘áº¿n chiáº¿n tranh.
3. Chá»n Ä‘á»‹nh nghÄ©a Ä‘Ãºng tá»« 4 lá»±a chá»n.
4. Tráº£ lá»i Ä‘Ãºng lÃ m Ä‘á»™i quÃ¢n cá»§a báº¡n máº¡nh hÆ¡n (+10 sá»©c máº¡nh).
5. Tráº£ lá»i sai lÃ m giáº£m mÃ¡u cá»§a báº¡n (-5 mÃ¡u).
6. HoÃ n thÃ nh má»—i cáº¥p Ä‘á»™ báº±ng cÃ¡ch tráº£ lá»i Ä‘Ãºng sá»‘ cÃ¢u há»i cáº§n thiáº¿t.
7. Nháº­n huy hiá»‡u khi hoÃ n thÃ nh nhiá»‡m vá»¥: NhÃ  chiáº¿n lÆ°á»£c, Chá»‰ huy, NgÆ°á»i chinh phá»¥c.
8. ÄÃ¡nh báº¡i TrÃ¹m cuá»‘i Ä‘á»ƒ tháº¯ng trÃ² chÆ¡i!

TrÃ² chÆ¡i káº¿t thÃºc: Náº¿u mÃ¡u cá»§a báº¡n vá» 0, Ä‘á»™i quÃ¢n cá»§a báº¡n bá»‹ Ä‘Ã¡nh báº¡i.

ChÃºc may máº¯n, Chá»‰ huy!`,
    scoring: `Há»‡ thá»‘ng tÃ­nh Ä‘iá»ƒm:
â€¢ Tráº£ lá»i Ä‘Ãºng: +10 Sá»©c máº¡nh Ä‘á»™i quÃ¢n
â€¢ Tráº£ lá»i sai: -5 MÃ¡u
â€¢ Cáº¥p Ä‘á»™ 1: HoÃ n thÃ nh 5 cÃ¢u tráº£ lá»i Ä‘Ãºng
â€¢ Cáº¥p Ä‘á»™ 2: HoÃ n thÃ nh 7 cÃ¢u tráº£ lá»i Ä‘Ãºng
â€¢ Cáº¥p Ä‘á»™ 3: HoÃ n thÃ nh 10 cÃ¢u tráº£ lá»i Ä‘Ãºng
â€¢ TrÃ¹m cuá»‘i: Tráº£ lá»i Ä‘Ãºng 10/12 cÃ¢u há»i
â€¢ Huy hiá»‡u: Nháº­n Ä‘Æ°á»£c khi hoÃ n thÃ nh má»—i cáº¥p Ä‘á»™`,
    level1: "Cáº¥p Ä‘á»™ 1: Tráº¡i lÃ­nh",
    level2: "Cáº¥p Ä‘á»™ 2: Chiáº¿n trÆ°á»ng",
    level3: "Cáº¥p Ä‘á»™ 3: Chiáº¿n dá»‹ch",
    finalBoss: "TrÃ¹m cuá»‘i: Tráº­n chiáº¿n cuá»‘i cÃ¹ng",
    gameOver: "TrÃ² chÆ¡i káº¿t thÃºc",
    gameOverMsg: "Äá»™i quÃ¢n cá»§a báº¡n Ä‘Ã£ bá»‹ Ä‘Ã¡nh báº¡i. HÃ£y thá»­ láº¡i Ä‘á»ƒ xÃ¢y dá»±ng Ä‘á»™i quÃ¢n tá»« vá»±ng máº¡nh hÆ¡n!",
    levelComplete: "Nhiá»‡m vá»¥ hoÃ n thÃ nh!",
    levelCompleteMsg: "Báº¡n Ä‘Ã£ hoÃ n thÃ nh thÃ nh cÃ´ng nhiá»‡m vá»¥ nÃ y. Äá»™i quÃ¢n cá»§a báº¡n ngÃ y cÃ ng máº¡nh hÆ¡n!",
    restart: "ChÆ¡i láº¡i",
    nextLevel: "Nhiá»‡m vá»¥ tiáº¿p theo",
    noBadges: "ChÆ°a cÃ³ huy hiá»‡u",
    barracksEmpty: "HoÃ n thÃ nh cÃ¡c tráº­n chiáº¿n Ä‘á»ƒ má»Ÿ khÃ³a tá»« vá»±ng trong doanh tráº¡i.",
    startBattle: "Báº¯t Ä‘áº§u tráº­n chiáº¿n",
    pressStart: "Nháº¥n \"Báº¯t Ä‘áº§u tráº­n chiáº¿n\" Ä‘á»ƒ báº¯t Ä‘áº§u nhiá»‡m vá»¥ Ä‘áº§u tiÃªn cá»§a báº¡n!"
  }
};
function t(k){return STRINGS[LANG][k]||k}

/* ===== vocabulary (default) ===== */
let defaultVocab = {
  level1: [
    {word:"soldier",def:"A person who serves in an army.",example:"The soldier fought bravely in the battle.",viDef:"NgÆ°á»i phá»¥c vá»¥ trong quÃ¢n Ä‘á»™i.",viExample:"NgÆ°á»i lÃ­nh Ä‘Ã£ chiáº¿n Ä‘áº¥u dÅ©ng cáº£m trong tráº­n Ä‘Ã¡nh.",cat:"war"},
    {word:"army",def:"An organized military force equipped for fighting.",example:"The army marched toward the enemy territory.",viDef:"Lá»±c lÆ°á»£ng quÃ¢n sá»± cÃ³ tá»• chá»©c Ä‘Æ°á»£c trang bá»‹ Ä‘á»ƒ chiáº¿n Ä‘áº¥u.",viExample:"QuÃ¢n Ä‘á»™i Ä‘Ã£ hÃ nh quÃ¢n vá» phÃ­a lÃ£nh thá»• káº» thÃ¹.",cat:"war"},
    {word:"weapon",def:"A thing designed or used for inflicting bodily harm or physical damage.",example:"Soldiers carry weapons for protection.",viDef:"Váº­t Ä‘Æ°á»£c thiáº¿t káº¿ hoáº·c sá»­ dá»¥ng Ä‘á»ƒ gÃ¢y ra tá»•n thÆ°Æ¡ng thá»ƒ cháº¥t hoáº·c thiá»‡t háº¡i váº­t cháº¥t.",viExample:"NgÆ°á»i lÃ­nh mang vÅ© khÃ­ Ä‘á»ƒ tá»± vá»‡.",cat:"war"},
    {word:"shield",def:"A broad piece of metal or another material held by soldiers to protect the body from weapons.",example:"The knight raised his shield to block the attack.",viDef:"Má»™t máº£nh kim loáº¡i rá»™ng hoáº·c váº­t liá»‡u khÃ¡c Ä‘Æ°á»£c ngÆ°á»i lÃ­nh cáº§m Ä‘á»ƒ báº£o vá»‡ cÆ¡ thá»ƒ khá»i vÅ© khÃ­.",viExample:"Hiá»‡p sÄ© Ä‘Ã£ khiÃªn cá»§a mÃ¬nh lÃªn Ä‘á»ƒ cháº·n Ä‘Ã²n táº¥n cÃ´ng.",cat:"war"},
    {word:"enemy",def:"A person or group that is actively opposed or hostile to someone or something.",example:"The enemy troops were approaching from the north.",viDef:"Má»™t ngÆ°á»i hoáº·c nhÃ³m tÃ­ch cá»±c pháº£n Ä‘á»‘i hoáº·c thÃ¹ Ä‘á»‹ch vá»›i ai Ä‘Ã³ hoáº·c Ä‘iá»u gÃ¬ Ä‘Ã³.",viExample:"QuÃ¢n Ä‘á»™i káº» thÃ¹ Ä‘ang tiáº¿p cáº­n tá»« phÃ­a báº¯c.",cat:"war"},
    {word:"fight",def:"Take part in a violent struggle involving the exchange of physical blows or the use of weapons.",example:"The soldiers began to fight when they saw the enemy.",viDef:"Tham gia vÃ o má»™t cuá»™c Ä‘áº¥u tranh báº¡o lá»±c liÃªn quan Ä‘áº¿n viá»‡c trao Ä‘á»•i Ä‘Ã²n táº¥n cÃ´ng váº­t lÃ½ hoáº·c sá»­ dá»¥ng vÅ© khÃ­.",viExample:"Nhá»¯ng ngÆ°á»i lÃ­nh báº¯t Ä‘áº§u chiáº¿n Ä‘áº¥u khi há» tháº¥y káº» thÃ¹.",cat:"war"},
    {word:"battle",def:"A sustained fight between large organized armed forces.",example:"The battle lasted for three days.",viDef:"Cuá»™c chiáº¿n Ä‘áº¥u kÃ©o dÃ i giá»¯a cÃ¡c lá»±c lÆ°á»£ng vÅ© trang lá»›n cÃ³ tá»• chá»©c.",viExample:"Tráº­n Ä‘Ã¡nh kÃ©o dÃ i trong ba ngÃ y.",cat:"war"},
    {word:"troops",def:"Soldiers or armed forces.",example:"The troops were deployed to the conflict zone.",viDef:"Nhá»¯ng ngÆ°á»i lÃ­nh hoáº·c lá»±c lÆ°á»£ng vÅ© trang.",viExample:"CÃ¡c quÃ¢n Ä‘á»™i Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai Ä‘áº¿n khu vá»±c xung Ä‘á»™t.",cat:"war"}
  ],
  level2: [
    {word:"strategy",def:"A plan of action designed to achieve a long-term or overall aim.",example:"The general developed a new strategy to win the war.",viDef:"Má»™t káº¿ hoáº¡ch hÃ nh Ä‘á»™ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu dÃ i háº¡n hoáº·c tá»•ng thá»ƒ.",viExample:"TÆ°á»›ng Ä‘Ã£ phÃ¡t triá»ƒn má»™t chiáº¿n lÆ°á»£c má»›i Ä‘á»ƒ tháº¯ng cuá»™c chiáº¿n.",cat:"war"},
    {word:"commander",def:"A person in authority, especially in a military context.",example:"The commander gave orders to advance.",viDef:"NgÆ°á»i cÃ³ quyá»n lá»±c, Ä‘áº·c biá»‡t trong bá»‘i cáº£nh quÃ¢n sá»±.",viExample:"Chá»‰ huy Ä‘Ã£ ra lá»‡nh tiáº¿n cÃ´ng.",cat:"war"},
    {word:"ally",def:"A state or person cooperating with another for a military or other purpose.",example:"The two countries were allies in the war.",viDef:"Má»™t quá»‘c gia hoáº·c ngÆ°á»i há»£p tÃ¡c vá»›i má»™t ngÆ°á»i khÃ¡c cho má»¥c Ä‘Ã­ch quÃ¢n sá»± hoáº·c khÃ¡c.",viExample:"Hai quá»‘c gia lÃ  Ä‘á»“ng minh trong cuá»™c chiáº¿n.",cat:"war"},
    {word:"invade",def:"Enter (a country or territory) with armed forces in order to attack, damage, or occupy it.",example:"The army prepared to invade the neighboring country.",viDef:"Nháº­p vÃ o (má»™t quá»‘c gia hoáº·c lÃ£nh thá»•) vá»›i lá»±c lÆ°á»£ng vÅ© trang Ä‘á»ƒ táº¥n cÃ´ng, gÃ¢y thiá»‡t háº¡i, hoáº·c chiáº¿m Ä‘Ã³ng nÃ³.",viExample:"QuÃ¢n Ä‘á»™i Ä‘Ã£ chuáº©n bá»‹ Ä‘á»ƒ xÃ¢m lÆ°á»£c quá»‘c gia lÃ¡ng giá»ng.",cat:"war"},
    {word:"defend",def:"Protect from harm or danger; resist attack.",example:"The soldiers had to defend the fortress.",viDef:"Báº£o vá»‡ khá»i tá»•n háº¡i hoáº·c nguy hiá»ƒm; khÃ¡ng cá»± sá»± táº¥n cÃ´ng.",viExample:"Nhá»¯ng ngÆ°á»i lÃ­nh pháº£i báº£o vá»‡ phÃ¡o Ä‘Ã i.",cat:"war"},
    {word:"surrender",def:"Cease resistance to an enemy or opponent and submit to their authority.",example:"The troops were forced to surrender.",viDef:"Ngá»«ng khÃ¡ng cá»± káº» thÃ¹ hoáº·c Ä‘á»‘i thá»§ vÃ  chá»‹u sá»± kiá»ƒm soÃ¡t cá»§a há».",viExample:"CÃ¡c quÃ¢n Ä‘á»™i Ä‘Ã£ buá»™c pháº£i Ä‘áº§u hÃ ng.",cat:"war"},
    {word:"retreat",def:"Withdraw from enemy forces as a result of their superior power or after a defeat.",example:"The army had to retreat after losing the battle.",viDef:"RÃºt lui khá»i lá»±c lÆ°á»£ng káº» thÃ¹ do sá»©c máº¡nh vÆ°á»£t trá»™i cá»§a há» hoáº·c sau má»™t tháº¥t báº¡i.",viExample:"QuÃ¢n Ä‘á»™i Ä‘Ã£ pháº£i rÃºt lui sau khi thua tráº­n.",cat:"war"},
    {word:"victory",def:"An act of defeating an enemy or opponent.",example:"The celebration lasted for days after the victory.",viDef:"HÃ nh Ä‘á»™ng Ä‘Ã¡nh báº¡i káº» thÃ¹ hoáº·c Ä‘á»‘i thá»§.",viExample:"Lá»… ká»· niá»‡m kÃ©o dÃ i nhiá»u ngÃ y sau chiáº¿n tháº¯ng.",cat:"war"},
    {word:"defeat",def:"Win against (an enemy or opponent) in a battle or other contest.",example:"The army was determined to defeat its enemies.",viDef:"Tháº¯ng (káº» thÃ¹ hoáº·c Ä‘á»‘i thá»§) trong má»™t tráº­n chiáº¿n hoáº·c cuá»™c thi khÃ¡c.",viExample:"QuÃ¢n Ä‘á»™i quyáº¿t tÃ¢m Ä‘Ã¡nh báº¡i káº» thÃ¹ cá»§a mÃ¬nh.",cat:"war"},
    {word:"combat",def:"Fighting between armed forces.",example:"The soldiers were engaged in combat.",viDef:"Cuá»™c chiáº¿n Ä‘áº¥u giá»¯a cÃ¡c lá»±c lÆ°á»£ng vÅ© trang.",viExample:"Nhá»¯ng ngÆ°á»i lÃ­nh Ä‘ang tham gia chiáº¿n Ä‘áº¥u.",cat:"war"}
  ],
  level3: [
    {word:"conflict",def:"A serious disagreement or argument, typically a protracted one.",example:"The conflict between the two nations lasted for decades.",viDef:"Má»™t báº¥t Ä‘á»“ng hoáº·c tranh cÃ£i nghiÃªm trá»ng, thÆ°á»ng lÃ  kÃ©o dÃ i.",viExample:"Xung Ä‘á»™t giá»¯a hai quá»‘c gia kÃ©o dÃ i trong nhiá»u tháº­p ká»·.",cat:"war"},
    {word:"negotiate",def:"Discuss something with someone in order to reach an agreement.",example:"The leaders met to negotiate a peace treaty.",viDef:"Tháº£o luáº­n Ä‘iá»u gÃ¬ Ä‘Ã³ vá»›i ai Ä‘Ã³ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c thá»a thuáº­n.",viExample:"CÃ¡c nhÃ  lÃ£nh Ä‘áº¡o Ä‘Ã£ gáº·p nhau Ä‘á»ƒ Ä‘Ã m phÃ¡n má»™t hiá»‡p Æ°á»›c hÃ²a bÃ¬nh.",cat:"war"},
    {word:"treaty",def:"A formally concluded and ratified agreement between states.",example:"The two countries signed a peace treaty.",viDef:"Má»™t thá»a thuáº­n Ä‘Æ°á»£c káº¿t luáº­n vÃ  phÃª chuáº©n chÃ­nh thá»©c giá»¯a cÃ¡c quá»‘c gia.",viExample:"Hai quá»‘c gia Ä‘Ã£ kÃ½ má»™t hiá»‡p Æ°á»›c hÃ²a bÃ¬nh.",cat:"war"},
    {word:"occupy",def:"Take control of (a place, especially a country) by military force.",example:"The invading army began to occupy the city.",viDef:"Náº¯m quyá»n kiá»ƒm soÃ¡t (má»™t nÆ¡i, Ä‘áº·c biá»‡t lÃ  má»™t quá»‘c gia) báº±ng lá»±c lÆ°á»£ng quÃ¢n sá»±.",viExample:"QuÃ¢n Ä‘á»™i xÃ¢m lÆ°á»£c báº¯t Ä‘áº§u chiáº¿m Ä‘Ã³ng thÃ nh phá»‘.",cat:"war"},
    {word:"revolution",def:"A forcible overthrow of a government or social order in favor of a new system.",example:"The revolution brought about significant changes.",viDef:"Sá»± láº­t Ä‘á»• báº±ng vÅ© lá»±c cá»§a má»™t chÃ­nh phá»§ hoáº·c tráº­t tá»± xÃ£ há»™i Ä‘á»ƒ á»§ng há»™ má»™t há»‡ thá»‘ng má»›i.",viExample:"Cuá»™c cÃ¡ch máº¡ng Ä‘Ã£ mang láº¡i nhá»¯ng thay Ä‘á»•i Ä‘Ã¡ng ká»ƒ.",cat:"war"},
    {word:"resistance",def:"The refusal to accept or comply with something; the attempt to prevent something by action or argument.",example:"The resistance movement fought against the occupation.",viDef:"Sá»± tá»« chá»‘i cháº¥p nháº­n hoáº·c tuÃ¢n theo Ä‘iá»u gÃ¬ Ä‘Ã³; ná»— lá»±c ngÄƒn cháº·n Ä‘iá»u gÃ¬ Ä‘Ã³ báº±ng hÃ nh Ä‘á»™ng hoáº·c láº­p luáº­n.",viExample:"Phong trÃ o khÃ¡ng chiáº¿n Ä‘Ã£ chiáº¿n Ä‘áº¥u chá»‘ng láº¡i sá»± chiáº¿m Ä‘Ã³ng.",cat:"war"},
    {word:"casualty",def:"A person killed or injured in a war or accident.",example:"There were many casualties in the battle.",viDef:"Má»™t ngÆ°á»i bá»‹ giáº¿t hoáº·c bá»‹ thÆ°Æ¡ng trong chiáº¿n tranh hoáº·c tai náº¡n.",viExample:"CÃ³ nhiá»u thÆ°Æ¡ng vong trong tráº­n Ä‘Ã¡nh.",cat:"war"},
    {word:"ammunition",def:"A supply or quantity of bullets and shells.",example:"The troops were running low on ammunition.",viDef:"Má»™t nguá»“n cung hoáº·c sá»‘ lÆ°á»£ng Ä‘áº¡n vÃ  vá» Ä‘áº¡n.",viExample:"CÃ¡c quÃ¢n Ä‘á»™i Ä‘ang cáº¡n kiá»‡t Ä‘áº¡n dÆ°á»£c.",cat:"war"},
    {word:"artillery",def:"Large-caliber guns used in warfare on land.",example:"The artillery bombarded the enemy positions.",viDef:"SÃºng cá»¡ lá»›n Ä‘Æ°á»£c sá»­ dá»¥ng trong chiáº¿n tranh trÃªn bá»™.",viExample:"PhÃ¡o binh Ä‘Ã£ báº¯n phÃ¡ cÃ¡c vá»‹ trÃ­ cá»§a káº» thÃ¹.",cat:"war"},
    {word:"ceasefire",def:"A temporary suspension of fighting.",example:"The ceasefire allowed civilians to leave the city.",viDef:"Má»™t sá»± Ä‘Ã¬nh chá»‰ chiáº¿n Ä‘áº¥u táº¡m thá»i.",viExample:"Lá»‡nh ngá»«ng báº¯n Ä‘Ã£ cho phÃ©p dÃ¢n thÆ°á»ng rá»i thÃ nh phá»‘.",cat:"war"}
  ],
  finalBoss: [
    {word:"armistice",def:"An agreement made by opposing sides in a war to stop fighting for a certain time.",example:"The armistice was signed after months of negotiation.",viDef:"Má»™t thá»a thuáº­n Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi cÃ¡c bÃªn Ä‘á»‘i láº­p trong má»™t cuá»™c chiáº¿n Ä‘á»ƒ ngá»«ng chiáº¿n Ä‘áº¥u trong má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh.",viExample:"Hiá»‡p Ä‘á»‹nh Ä‘Ã¬nh chiáº¿n Ä‘Ã£ Ä‘Æ°á»£c kÃ½ sau nhiá»u thÃ¡ng Ä‘Ã m phÃ¡n.",cat:"war"},
    {word:"siege",def:"A military operation in which an enemy surrounds a town or building, cutting off essential supplies.",example:"The siege of the city lasted for nearly a year.",viDef:"Má»™t hoáº¡t Ä‘á»™ng quÃ¢n sá»± trong Ä‘Ã³ káº» thÃ¹ bao vÃ¢y má»™t thá»‹ tráº¥n hoáº·c tÃ²a nhÃ , cáº¯t Ä‘á»©t nguá»“n cung cáº¥p thiáº¿t yáº¿u.",viExample:"Cuá»™c bao vÃ¢y thÃ nh phá»‘ kÃ©o dÃ i gáº§n má»™t nÄƒm.",cat:"war"},
    {word:"guerrilla",def:"A member of a small independent group taking part in irregular fighting, typically against larger regular forces.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"Má»™t thÃ nh viÃªn cá»§a má»™t nhÃ³m nhá» Ä‘á»™c láº­p tham gia vÃ o cÃ¡c tráº­n chiáº¿n khÃ´ng Ä‘á»u Ä‘áº·n, thÆ°á»ng chá»‘ng láº¡i cÃ¡c lá»±c lÆ°á»£ng thÆ°á»ng quy lá»›n hÆ¡n.",viExample:"CÃ¡c chiáº¿n binh du kÃ­ch Ä‘Ã£ sá»­ dá»¥ng chiáº¿n thuáº­t Ä‘Ã¡nh vÃ  cháº¡y.",cat:"war"},
    {word:"reconnaissance",def:"Military observation of a region to locate an enemy or ascertain strategic features.",example:"The plane was on a reconnaissance mission.",viDef:"Quan sÃ¡t quÃ¢n sá»± má»™t khu vá»±c Ä‘á»ƒ Ä‘á»‹nh vá»‹ káº» thÃ¹ hoáº·c xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘áº·c Ä‘iá»ƒm chiáº¿n lÆ°á»£c.",viExample:"Chiáº¿c mÃ¡y bay Ä‘ang thá»±c hiá»‡n nhiá»‡m vá»¥ trinh sÃ¡t.",cat:"war"},
    {word:"battalion",def:"A large body of troops ready for battle, especially an infantry unit forming part of a brigade typically commanded by a lieutenant colonel.",example:"The battalion was sent to reinforce the front lines.",viDef:"Má»™t lá»±c lÆ°á»£ng lá»›n quÃ¢n Ä‘á»™i sáºµn sÃ ng chiáº¿n Ä‘áº¥u, Ä‘áº·c biá»‡t lÃ  má»™t Ä‘Æ¡n vá»‹ bá»™ binh hÃ¬nh thÃ nh má»™t pháº§n cá»§a má»™t lá»¯ Ä‘oÃ n thÆ°á»ng Ä‘Æ°á»£c chá»‰ huy bá»Ÿi má»™t trung tÃ¡.",viExample:"Tiá»ƒu Ä‘oÃ n Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n Ä‘á»ƒ tÄƒng cÆ°á»ng cho tiá»n tuyáº¿n.",cat:"war"},
    {word:"deployment",def:"The movement of troops or equipment to a place or position for military action.",example:"The deployment of additional troops was approved.",viDef:"Sá»± di chuyá»ƒn cá»§a quÃ¢n Ä‘á»™i hoáº·c thiáº¿t bá»‹ Ä‘áº¿n má»™t nÆ¡i hoáº·c vá»‹ trÃ­ cho hÃ nh Ä‘á»™ng quÃ¢n sá»±.",viExample:"Viá»‡c triá»ƒn khai thÃªm quÃ¢n Ä‘á»™i Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t.",cat:"war"},
    {word:"armistice",def:"An agreement made by opposing sides in a war to stop fighting for a certain time.",example:"The armistice was signed after months of negotiation.",viDef:"Má»™t thá»a thuáº­n Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi cÃ¡c bÃªn Ä‘á»‘i láº­p trong má»™t cuá»™c chiáº¿n Ä‘á»ƒ ngá»«ng chiáº¿n Ä‘áº¥u trong má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh.",viExample:"Hiá»‡p Ä‘á»‹nh Ä‘Ã¬nh chiáº¿n Ä‘Ã£ Ä‘Æ°á»£c kÃ½ sau nhiá»u thÃ¡ng Ä‘Ã m phÃ¡n.",cat:"war"},
    {word:"siege",def:"A military operation in which an enemy surrounds a town or building, cutting off essential supplies.",example:"The siege of the city lasted for nearly a year.",viDef:"Má»™t hoáº¡t Ä‘á»™ng quÃ¢n sá»± trong Ä‘Ã³ káº» thÃ¹ bao vÃ¢y má»™t thá»‹ tráº¥n hoáº·c tÃ²a nhÃ , cáº¯t Ä‘á»©t nguá»“n cung cáº¥p thiáº¿t yáº¿u.",viExample:"Cuá»™c bao vÃ¢y thÃ nh phá»‘ kÃ©o dÃ i gáº§n má»™t nÄƒm.",cat:"war"},
    {word:"guerrilla",def:"A member of a small independent group taking part in irregular fighting, typically against larger regular forces.",example:"Guerrilla fighters used hit-and-run tactics.",viDef:"Má»™t thÃ nh viÃªn cá»§a má»™t nhÃ³m nhá» Ä‘á»™c láº­p tham gia vÃ o cÃ¡c tráº­n chiáº¿n khÃ´ng Ä‘á»u Ä‘áº·n, thÆ°á»ng chá»‘ng láº¡i cÃ¡c lá»±c lÆ°á»£ng thÆ°á»ng quy lá»›n hÆ¡n.",viExample:"CÃ¡c chiáº¿n binh du kÃ­ch Ä‘Ã£ sá»­ dá»¥ng chiáº¿n thuáº­t Ä‘Ã¡nh vÃ  cháº¡y.",cat:"war"},
    {word:"reconnaissance",def:"Military observation of a region to locate an enemy or ascertain strategic features.",example:"The plane was on a reconnaissance mission.",viDef:"Quan sÃ¡t quÃ¢n sá»± má»™t khu vá»±c Ä‘á»ƒ Ä‘á»‹nh vá»‹ káº» thÃ¹ hoáº·c xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘áº·c Ä‘iá»ƒm chiáº¿n lÆ°á»£c.",viExample:"Chiáº¿c mÃ¡y bay Ä‘ang thá»±c hiá»‡n nhiá»‡m vá»¥ trinh sÃ¡t.",cat:"war"},
    {word:"battalion",def:"A large body of troops ready for battle, especially an infantry unit forming part of a brigade typically commanded by a lieutenant colonel.",example:"The battalion was sent to reinforce the front lines.",viDef:"Má»™t lá»±c lÆ°á»£ng lá»›n quÃ¢n Ä‘á»™i sáºµn sÃ ng chiáº¿n Ä‘áº¥u, Ä‘áº·c biá»‡t lÃ  má»™t Ä‘Æ¡n vá»‹ bá»™ binh hÃ¬nh thÃ nh má»™t pháº§n cá»§a má»™t lá»¯ Ä‘oÃ n thÆ°á»ng Ä‘Æ°á»£c chá»‰ huy bá»Ÿi má»™t trung tÃ¡.",viExample:"Tiá»ƒu Ä‘oÃ n Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n Ä‘á»ƒ tÄƒng cÆ°á»ng cho tiá»n tuyáº¿n.",cat:"war"},
    {word:"deployment",def:"The movement of troops or equipment to a place or position for military action.",example:"The deployment of additional troops was approved.",viDef:"Sá»± di chuyá»ƒn cá»§a quÃ¢n Ä‘á»™i hoáº·c thiáº¿t bá»‹ Ä‘áº¿n má»™t nÆ¡i hoáº·c vá»‹ trÃ­ cho hÃ nh Ä‘á»™ng quÃ¢n sá»±.",viExample:"Viá»‡c triá»ƒn khai thÃªm quÃ¢n Ä‘á»™i Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t.",cat:"war"}
  ]
};

/* ===== local storage helpers ===== */
function loadVocab(){
  let v = localStorage.getItem('wb_vocab');
  if(v) try{return JSON.parse(v);}catch(e){}
  return JSON.parse(JSON.stringify(defaultVocab));
}
let vocab = loadVocab();

let state = {
  currentLevel: 1,
  health: 100,
  armyStrength: 0,
  levelProgress: { correct: 0, total: 5 }, // level1: 5, level2: 7, level3: 10, finalBoss: 10/12
  badges: [],
  learnedWords: []
};
function loadState(){
  let s = localStorage.getItem('wb_state');
  if(s) try{state=Object.assign(state,JSON.parse(s));}catch(e){}
}
function saveState(){localStorage.setItem('wb_state',JSON.stringify(state));updateHUD();updateBarracks();}
loadState();

/* ===== HUD & UI wiring ===== */
function updateHUD(){
  document.getElementById('score').innerText = (LANG==='en'? 'Army: ' : 'QuÃ¢n Ä‘á»™i: ') + state.armyStrength;
  document.getElementById('level').innerText = state.currentLevel;
  document.getElementById('health').innerText = state.health;
  document.getElementById('healthPercent').innerText = state.health + '%';
  document.getElementById('healthBar').style.width = state.health + '%';
  document.getElementById('strengthValue').innerText = state.armyStrength;
  document.getElementById('strengthBar').style.width = Math.min(state.armyStrength, 100) + '%';
  
  // Update level info
  let levelNames = {
    1: t('level1'),
    2: t('level2'),
    3: t('level3'),
    4: t('finalBoss')
  };
  document.getElementById('currentLevel').innerText = levelNames[state.currentLevel];
  
  // Update progress
  let progress = (state.levelProgress.correct / state.levelProgress.total) * 100;
  document.getElementById('levelProgress').style.width = progress + '%';
  document.getElementById('progressText').innerText = state.levelProgress.correct + '/' + state.levelProgress.total;
  
  // Update badges
  updateBadges();
}
updateHUD();

function updateBadges() {
  const badgesContainer = document.getElementById('badgesContainer');
  badgesContainer.innerHTML = '';
  
  if (state.badges.length === 0) {
    badgesContainer.innerHTML = `<div class="badge" style="background:#555">${t('noBadges')}</div>`;
    return;
  }
  
  const badgeNames = {
    'strategist': LANG === 'en' ? 'The Strategist' : 'NhÃ  chiáº¿n lÆ°á»£c',
    'commander': LANG === 'en' ? 'The Commander' : 'Chá»‰ huy',
    'conqueror': LANG === 'en' ? 'The Conqueror' : 'NgÆ°á»i chinh phá»¥c'
  };
  
  state.badges.forEach(badge => {
    const badgeEl = document.createElement('div');
    badgeEl.className = 'badge';
    badgeEl.innerText = badgeNames[badge] || badge;
    badgesContainer.appendChild(badgeEl);
  });
}

function updateBarracks() {
  const barracksContent = document.getElementById('barracksContent');
  
  if (state.learnedWords.length === 0) {
    barracksContent.innerHTML = `<p style="color:var(--muted)">${t('barracksEmpty')}</p>`;
    return;
  }
  
  barracksContent.innerHTML = '<h4>Your Vocabulary Army:</h4>';
  
  const wordsList = document.createElement('div');
  wordsList.style.display = 'flex';
  wordsList.style.flexWrap = 'wrap';
  wordsList.style.gap = '8px';
  wordsList.style.marginTop = '10px';
  
  state.learnedWords.forEach(word => {
    const wordEl = document.createElement('div');
    wordEl.style.padding = '5px 10px';
    wordEl.style.background = 'rgba(138,194,73,0.2)';
    wordEl.style.borderRadius = '15px';
    wordEl.style.fontSize = '14px';
    wordEl.innerText = word;
    wordsList.appendChild(wordEl);
  });
  
  barracksContent.appendChild(wordsList);
}

const views = {battle:document.getElementById('view-battle'),barracks:document.getElementById('view-barracks'),edit:document.getElementById('view-edit')};
const btnBattle=document.getElementById('btn-battle'),btnBarracks=document.getElementById('btn-barracks'),btnEdit=document.getElementById('btn-edit');
btnBattle.onclick=()=>show('battle');btnBarracks.onclick=()=>show('barracks');btnEdit.onclick=()=>show('edit');
function show(v){
  for(let k in views){views[k].style.display='none';}
  btnBattle.classList.remove('active');btnBarracks.classList.remove('active');btnEdit.classList.remove('active');
  if(v==='battle'){views.battle.style.display='block';btnBattle.classList.add('active'); stopTimer(); resetBattleArea();}
  if(v==='barracks'){views.barracks.style.display='block';btnBarracks.classList.add('active'); updateBarracks();}
  if(v==='edit'){views.edit.style.display='block';btnEdit.classList.add('active');document.getElementById('vocabJson').value = JSON.stringify(vocab,null,2)}
}

/* ===== language toggles ===== */
document.getElementById('langEn').onclick=()=>{LANG='en';applyLang();};
document.getElementById('langVi').onclick=()=>{LANG='vi';applyLang();};
function applyLang(){
  document.getElementById('btn-battle').innerText = STRINGS[LANG].battle;
  document.getElementById('btn-barracks').innerText = STRINGS[LANG].barracks;
  document.getElementById('btn-edit').innerText = STRINGS[LANG].edit;
  document.getElementById('footer').innerText = STRINGS[LANG].tip;
  document.getElementById('btn-help').onclick = ()=>alert(STRINGS[LANG].how + '\n\n' + STRINGS[LANG].scoring);
  document.getElementById('nextBattle').innerText = STRINGS[LANG].startBattle;
  document.getElementById('questionText').innerText = STRINGS[LANG].pressStart;
  updateHUD();
}
applyLang();

/* ===== small controls ===== */
document.getElementById('btn-reset').onclick=()=>{
  if(confirm(LANG==='en'? 'Reset all progress and start over?':'Báº¡n cÃ³ cháº¯c muá»‘n Ä‘áº·t láº¡i tiáº¿n trÃ¬nh vÃ  báº¯t Ä‘áº§u láº¡i?')){
    localStorage.removeItem('wb_state');
    state = {
      currentLevel: 1,
      health: 100,
      armyStrength: 0,
      levelProgress: { correct: 0, total: 5 },
      badges: [],
      learnedWords: []
    };
    saveState();
    alert(LANG==='en'? 'Game reset. Good luck, Commander!' : 'ÄÃ£ Ä‘áº·t láº¡i trÃ² chÆ¡i. ChÃºc may máº¯n, Chá»‰ huy!');
  }
};
document.getElementById('btn-help').onclick=()=>alert(STRINGS[LANG].how + '\n\n' + STRINGS[LANG].scoring);

/* ===== battle logic ===== */
let battleTimerId=null;let battleTime=20;let currentQ=null;
function pickQuestion(level){
  let pool;
  if(level === 4) {
    pool = vocab.finalBoss;
  } else {
    let levelKey = 'level' + level;
    pool = vocab[levelKey];
  }
  
  if(pool.length===0) return null;
  let correct = pool[Math.floor(Math.random()*pool.length)];
  let options = [correct];
  
  // Add 3 distractors from the same level
  while(options.length<4){
    let cand = pool[Math.floor(Math.random()*pool.length)];
    if(!options.find(o=>o.word===cand.word)) options.push(cand);
  }
  
  // Shuffle options
  for(let i=options.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[options[i],options[j]]=[options[j],options[i]]}
  return {q:correct,options};
}

document.getElementById('nextBattle').onclick=()=>startBattle();
function startBattle(){
  stopTimer();
  resetBattleArea();
  
  let q = pickQuestion(state.currentLevel);
  if(!q){
    document.getElementById('questionText').innerText=(LANG==='en'? 'No words available for this level.' : 'KhÃ´ng cÃ³ tá»« nÃ o cho cáº¥p Ä‘á»™ nÃ y.');
    return;
  }
  
  currentQ=q;
  document.getElementById('questionText').innerText = (LANG==='en'? 'What is the meaning of: "' : 'NghÄ©a cá»§a tá»« lÃ : "') + q.q.word + '"?';
  let opts = document.getElementById('options');opts.innerHTML='';
  
  q.options.forEach(o=>{
    let b = document.createElement('div');
    b.className='option';
    b.innerText=o.def;
    b.onclick=()=>selectOption(b,o);
    opts.appendChild(b);
  });
  
  battleTime=20;
  document.getElementById('timer').innerText=battleTime+'s';
  battleTimerId=setInterval(()=>{
    battleTime--;
    document.getElementById('timer').innerText=battleTime+'s';
    if(battleTime<=0){
      stopTimer();
      revealAnswer(null);
    }
  },1000);
}

function resetBattleArea() {
  document.getElementById('questionText').innerText = STRINGS[LANG].pressStart;
  document.getElementById('options').innerHTML = '';
  document.getElementById('timer').innerText = '--';
  currentQ = null;
}

function stopTimer(){
  if(battleTimerId)clearInterval(battleTimerId);
  battleTimerId=null;
  document.getElementById('timer').innerText='--';
}

function selectOption(el,opt){
  stopTimer();
  if(!currentQ) return;
  
  let correct = currentQ.q.word===opt.word;
  if(correct){
    el.classList.add('correct');
    onCorrect();
  } else {
    el.classList.add('wrong');
    onWrong();
    revealAnswer(opt);
  }
  
  // Show correct answer
  let opts = document.querySelectorAll('.option');
  opts.forEach(o=>{
    if(o.innerText===currentQ.q.def) o.classList.add('correct');
  });
}

function revealAnswer(selected){
  if(!currentQ) return;
  
  let area = document.getElementById('questionText');
  let example = LANG==='en'? currentQ.q.example : currentQ.q.viExample;
  area.innerText = (LANG==='en'? 'Word: ' : 'Tá»«: ') + currentQ.q.word + 
                 '\n' + (LANG==='en'? 'Definition: ' : 'Äá»‹nh nghÄ©a: ') + currentQ.q.def + 
                 '\n' + (LANG==='en'? 'Example: ' : 'VÃ­ dá»¥: ') + example;
}

function onCorrect(){
  state.armyStrength += 10;
  state.levelProgress.correct++;
  
  // Add word to learned words if not already there
  if(!state.learnedWords.includes(currentQ.q.word)){
    state.learnedWords.push(currentQ.q.word);
  }
  
  // Check if level is complete
  if(state.currentLevel === 4) {
    // Final boss - special handling
    if(state.levelProgress.correct >= 10) {
      // Player wins the game
      showLevelComplete();
    }
  } else if(state.levelProgress.correct >= state.levelProgress.total) {
    // Regular level complete
    showLevelComplete();
  }
  
  saveState();
}

function onWrong(){
  state.health -= 5;
  
  if(state.health <= 0) {
    state.health = 0;
    saveState();
    showGameOver();
  } else {
    saveState();
  }
}

function showGameOver() {
  document.getElementById('gameOverTitle').innerText = STRINGS[LANG].gameOver;
  document.getElementById('gameOverMessage').innerText = STRINGS[LANG].gameOverMsg;
  document.getElementById('restartBtn').innerText = STRINGS[LANG].restart;
  document.getElementById('gameOverModal').style.display = 'flex';
}

function showLevelComplete() {
  let badge = '';
  let title = '';
  
  if(state.currentLevel === 1) {
    badge = 'strategist';
    title = LANG === 'en' ? 'The Strategist' : 'NhÃ  chiáº¿n lÆ°á»£c';
  } else if(state.currentLevel === 2) {
    badge = 'commander';
    title = LANG === 'en' ? 'The Commander' : 'Chá»‰ huy';
  } else if(state.currentLevel === 3) {
    badge = 'conqueror';
    title = LANG === 'en' ? 'The Conqueror' : 'NgÆ°á»i chinh phá»¥c';
  } else if(state.currentLevel === 4) {
    // Final boss completed - game won
    document.getElementById('levelCompleteTitle').innerText = LANG === 'en' ? 'Victory!' : 'Chiáº¿n tháº¯ng!';
    document.getElementById('levelCompleteMessage').innerText = LANG === 'en' ? 
      'Congratulations! You have conquered the Word Battlefield and become a master of war vocabulary!' : 
      'ChÃºc má»«ng! Báº¡n Ä‘Ã£ chinh phá»¥c Chiáº¿n trÆ°á»ng Tá»« vá»±ng vÃ  trá»Ÿ thÃ nh báº­c tháº§y tá»« vá»±ng chiáº¿n tranh!';
    document.getElementById('nextLevelBtn').innerText = LANG === 'en' ? 'Play Again' : 'ChÆ¡i láº¡i';
    document.getElementById('levelCompleteModal').style.display = 'flex';
    return;
  }
  
  // Add badge if not already earned
  if(!state.badges.includes(badge)) {
    state.badges.push(badge);
  }
  
  document.getElementById('levelCompleteTitle').innerText = STRINGS[LANG].levelComplete;
  document.getElementById('levelCompleteMessage').innerText = STRINGS[LANG].levelCompleteMsg + ' ' + 
    (LANG === 'en' ? `You've earned the "${title}" badge!` : `Báº¡n Ä‘Ã£ nháº­n Ä‘Æ°á»£c huy hiá»‡u "${title}"!`);
  document.getElementById('nextLevelBtn').innerText = STRINGS[LANG].nextLevel;
  document.getElementById('levelCompleteModal').style.display = 'flex';
}

function nextLevel() {
  document.getElementById('levelCompleteModal').style.display = 'none';
  
  if(state.currentLevel === 4) {
    // Game completed - restart
    document.getElementById('btn-reset').click();
    return;
  }
  
  // Move to next level
  state.currentLevel++;
  
  // Set level progress requirements
  if(state.currentLevel === 2) {
    state.levelProgress = { correct: 0, total: 7 };
  } else if(state.currentLevel === 3) {
    state.levelProgress = { correct: 0, total: 10 };
  } else if(state.currentLevel === 4) {
    state.levelProgress = { correct: 0, total: 12 };
  }
  
  saveState();
  resetBattleArea();
}

// Modal event listeners
document.getElementById('restartBtn').onclick = function() {
  document.getElementById('gameOverModal').style.display = 'none';
  document.getElementById('btn-reset').click();
};

document.getElementById('nextLevelBtn').onclick = nextLevel;

/* ===== edit & save vocab ===== */
document.getElementById('saveVocab').onclick=()=>{
  try{
    let j = JSON.parse(document.getElementById('vocabJson').value);
    if(!j.level1 || !j.level2 || !j.level3 || !j.finalBoss) {
      throw (LANG==='en' ? 'Vocabulary must include level1, level2, level3, and finalBoss arrays' : 'Tá»« vá»±ng pháº£i bao gá»“m cÃ¡c máº£ng level1, level2, level3 vÃ  finalBoss');
    }
    
    vocab = j;
    localStorage.setItem('wb_vocab', JSON.stringify(vocab));
    alert(LANG==='en'? 'Saved successfully!' : 'ÄÃ£ lÆ°u thÃ nh cÃ´ng!');
  } catch(e){
    alert((LANG==='en'? 'Error: ' : 'Lá»—i: ') + e);
  }
};

document.getElementById('resetVocab').onclick=()=>{
  if(confirm(LANG==='en'? 'Reset vocabulary to default?':'Báº¡n cÃ³ muá»‘n Ä‘áº·t láº¡i danh sÃ¡ch tá»« vá» máº·c Ä‘á»‹nh?')){
    vocab = JSON.parse(JSON.stringify(defaultVocab));
    localStorage.removeItem('wb_vocab');
    document.getElementById('vocabJson').value=JSON.stringify(vocab,null,2);
    alert(LANG==='en'? 'Reset to default.' : 'ÄÃ£ Ä‘áº·t láº¡i máº·c Ä‘á»‹nh.');
  }
};

/* ===== init ===== */
updateBarracks();
document.getElementById('vocabJson').value = JSON.stringify(vocab,null,2);

/* ===== download handler ===== */
document.getElementById('downloadBtn').addEventListener('click', (e)=>{
  const blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  e.currentTarget.href = url;
});
</script>
</body>
</html>
